\* TLC Configuration for KelpieHttpApi
\*
\* Run with: java -XX:+UseParallelGC -jar tla2tools.jar -deadlock -config KelpieHttpApi.cfg KelpieHttpApi.tla

\* =========================================================================
\* SPECIFICATION
\* =========================================================================

\* Use safety-only spec (no liveness checking)
\* This verifies HTTP linearizability invariants efficiently
SPECIFICATION SafetySpec

\* =========================================================================
\* CONSTANTS
\* =========================================================================

\* Small model for tractable checking
\* 2 clients, 2 agents, 2 tokens is sufficient to find linearizability violations
CONSTANT
    HttpClients = {c1, c2}
    Agents = {a1, a2}
    IdempotencyTokens = {t1, t2, t3}
    NONE = NONE
    MAX_OPERATIONS = 6

\* =========================================================================
\* STATE CONSTRAINT (for bounded model checking)
\* =========================================================================

\* Limit state space for tractable checking
\* Ensures finite state space for model checking
CONSTRAINT StateConstraint

\* =========================================================================
\* INVARIANTS (Safety Properties)
\* =========================================================================

\* Check all safety invariants
INVARIANT TypeOK
INVARIANT IdempotencyGuarantee
INVARIANT ExactlyOnceExecution
INVARIANT ReadAfterWriteConsistency
INVARIANT AtomicOperation
INVARIANT DurableOnSuccess
