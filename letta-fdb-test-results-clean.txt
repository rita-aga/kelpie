[0;32m=== Running Letta SDK Tests Against Kelpie+FDB ===[0m
[1;33mConfig:[0m
  FDB Cluster: /usr/local/etc/foundationdb/fdb.cluster
  Kelpie Port: 8283
  Letta Repo:  ./letta-repo

[0;32m[1/5] Building Kelpie server...[0m
[0;32m[2/5] Starting Kelpie server with FDB backend...[0m
  Server PID: 5415
[1;33mWaiting for server health check...[0m
[2m2026-01-25T16:37:34.177275Z[0m [32m INFO[0m [2mkelpie_server[0m[2m:[0m Kelpie server v0.1.0
[2m2026-01-25T16:37:34.177339Z[0m [32m INFO[0m [2mkelpie_server[0m[2m:[0m Config: kelpie.yaml
[2m2026-01-25T16:37:34.177370Z[0m [32m INFO[0m [2mkelpie_server[0m[2m:[0m Connecting to FoundationDB: /usr/local/etc/foundationdb/fdb.cluster
[2m2026-01-25T16:37:34.181434Z[0m [32m INFO[0m [2mkelpie_server[0m[2m:[0m FDB storage initialized
[2m2026-01-25T16:37:34.184940Z[0m [32m INFO[0m [2mkelpie_server::state[0m[2m:[0m Initializing actor-based agent service
[2m2026-01-25T16:37:34.185045Z[0m [32m INFO[0m [1mrun[0m[2m:[0m [2mkelpie_runtime::dispatcher[0m[2m:[0m Dispatcher starting
[2m2026-01-25T16:37:34.185142Z[0m [32m INFO[0m [2mkelpie_server[0m[2m:[0m Registered builtin tools: shell
[2m2026-01-25T16:37:34.185183Z[0m [32m INFO[0m [2mkelpie_server::tools::memory[0m[2m:[0m Registered memory tools: core_memory_append, core_memory_replace, archival_memory_insert, archival_memory_search, conversation_search, conversation_search_date
[2m2026-01-25T16:37:34.185188Z[0m [32m INFO[0m [2mkelpie_server::tools::heartbeat[0m[2m:[0m Registered heartbeat tools: pause_heartbeats
[2m2026-01-25T16:37:34.185191Z[0m [32m INFO[0m [2mkelpie_server::tools::messaging[0m[2m:[0m Registered messaging tools: send_message
[2m2026-01-25T16:37:34.185194Z[0m [32m INFO[0m [2mkelpie_server::tools::web_search[0m[2m:[0m Registered prebuilt tool: web_search
[2m2026-01-25T16:37:34.185198Z[0m [32m INFO[0m [2mkelpie_server::tools::code_execution[0m[2m:[0m Registered prebuilt tool: run_code
[2m2026-01-25T16:37:34.185212Z[0m [32m INFO[0m [2mkelpie_server::state[0m[2m:[0m loading custom tools from storage...
[2m2026-01-25T16:37:34.190437Z[0m [32m INFO[0m [2mkelpie_server::state[0m[2m:[0m found custom tools in storage [3mcount[0m[2m=[0m6
[2m2026-01-25T16:37:34.190457Z[0m [32m INFO[0m [2mkelpie_server::state[0m[2m:[0m loading custom tool from storage [3mname[0m[2m=[0mdebug_test
[2m2026-01-25T16:37:34.190541Z[0m [32m INFO[0m [2mkelpie_server::state[0m[2m:[0m loading custom tool from storage [3mname[0m[2m=[0mfdb_persist_test
[2m2026-01-25T16:37:34.190545Z[0m [32m INFO[0m [2mkelpie_server::state[0m[2m:[0m loading custom tool from storage [3mname[0m[2m=[0mfinal_test_tool
[2m2026-01-25T16:37:34.190547Z[0m [32m INFO[0m [2mkelpie_server::state[0m[2m:[0m loading custom tool from storage [3mname[0m[2m=[0mpersist_test_v2
[2m2026-01-25T16:37:34.190551Z[0m [32m INFO[0m [2mkelpie_server::state[0m[2m:[0m loading custom tool from storage [3mname[0m[2m=[0mpersist_test_v3
[2m2026-01-25T16:37:34.190553Z[0m [32m INFO[0m [2mkelpie_server::state[0m[2m:[0m loading custom tool from storage [3mname[0m[2m=[0mtest_tool
[2m2026-01-25T16:37:34.191618Z[0m [32m INFO[0m [2mkelpie_server::storage::fdb[0m[2m:[0m list_agents complete [3magent_count[0m[2m=[0m88
[2m2026-01-25T16:37:34.321939Z[0m [32m INFO[0m [2mkelpie_server::state[0m[2m:[0m loaded agents from storage [3mcount[0m[2m=[0m88
[2m2026-01-25T16:37:34.342068Z[0m [32m INFO[0m [2mkelpie_server::state[0m[2m:[0m loaded MCP servers from storage [3mcount[0m[2m=[0m18
[2m2026-01-25T16:37:34.344512Z[0m [32m INFO[0m [2mkelpie_server::state[0m[2m:[0m loaded agent groups from storage [3mcount[0m[2m=[0m2
[2m2026-01-25T16:37:34.347001Z[0m [32m INFO[0m [2mkelpie_server::state[0m[2m:[0m loaded identities from storage [3mcount[0m[2m=[0m2
[2m2026-01-25T16:37:34.347783Z[0m [32m INFO[0m [2mkelpie_server::state[0m[2m:[0m loaded projects from storage [3mcount[0m[2m=[0m0
[2m2026-01-25T16:37:34.348622Z[0m [32m INFO[0m [2mkelpie_server::state[0m[2m:[0m loaded jobs from storage [3mcount[0m[2m=[0m0
[2m2026-01-25T16:37:34.349024Z[0m [32m INFO[0m [2mkelpie_server[0m[2m:[0m Starting HTTP server on 0.0.0.0:8283
[2m2026-01-25T16:37:34.349030Z[0m [32m INFO[0m [2mkelpie_server[0m[2m:[0m API endpoints:
[2m2026-01-25T16:37:34.349031Z[0m [32m INFO[0m [2mkelpie_server[0m[2m:[0m   GET  /health                           - Health check
[2m2026-01-25T16:37:34.349032Z[0m [32m INFO[0m [2mkelpie_server[0m[2m:[0m   GET  /metrics                          - Prometheus metrics
[2m2026-01-25T16:37:34.349033Z[0m [32m INFO[0m [2mkelpie_server[0m[2m:[0m   GET  /v1/capabilities                  - Server capabilities
[2m2026-01-25T16:37:34.349035Z[0m [32m INFO[0m [2mkelpie_server[0m[2m:[0m   GET  /v1/agents                        - List agents
[2m2026-01-25T16:37:34.349037Z[0m [32m INFO[0m [2mkelpie_server[0m[2m:[0m   GET  /v1/agents/{id}                   - Get agent
[2m2026-01-25T16:37:34.349038Z[0m [32m INFO[0m [2mkelpie_server[0m[2m:[0m   PATCH /v1/agents/{id}                  - Update agent
[2m2026-01-25T16:37:34.349043Z[0m [32m INFO[0m [2mkelpie_server[0m[2m:[0m   DELETE /v1/agents/{id}                 - Delete agent
[2m2026-01-25T16:37:34.349044Z[0m [32m INFO[0m [2mkelpie_server[0m[2m:[0m   GET  /v1/agents/{id}/blocks            - List blocks
[2m2026-01-25T16:37:34.349046Z[0m [32m INFO[0m [2mkelpie_server[0m[2m:[0m   PATCH /v1/agents/{id}/blocks/{bid}     - Update block
[2m2026-01-25T16:37:34.349072Z[0m [32m INFO[0m [2mkelpie_server[0m[2m:[0m   GET  /v1/agents/{id}/messages          - List messages
[2m2026-01-25T16:37:34.349082Z[0m [32m INFO[0m [2mkelpie_server[0m[2m:[0m   POST /v1/agents/{id}/messages          - Send message
[2m2026-01-25T16:37:34.349083Z[0m [32m INFO[0m [2mkelpie_server[0m[2m:[0m   GET  /v1/agents/{id}/archival          - Search archival memory
[2m2026-01-25T16:37:34.349084Z[0m [32m INFO[0m [2mkelpie_server[0m[2m:[0m   POST /v1/agents/{id}/archival          - Add to archival memory
[2m2026-01-25T16:37:34.349086Z[0m [32m INFO[0m [2mkelpie_server[0m[2m:[0m   GET  /v1/tools                         - List tools
[2m2026-01-25T16:37:34.349087Z[0m [32m INFO[0m [2mkelpie_server[0m[2m:[0m   POST /v1/tools                         - Register tool
[2m2026-01-25T16:37:34.349088Z[0m [32m INFO[0m [2mkelpie_server[0m[2m:[0m   POST /v1/tools/{name}/execute          - Execute tool
.
[0;32m  âœ“ Server is ready[0m
[0;32m[3/5] Using existing Letta repository[0m
[1;33m  (To update: rm -rf ./letta-repo and re-run)[0m
[0;32m[4/5] Installing Letta SDK dependencies...[0m
[0;32m[5/5] Running Letta SDK tests against Kelpie+FDB...[0m

[1;33mRunning core compatibility tests...[0m
OpenTelemetry configuration OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE is not supported by Datadog.
============================= test session starts ==============================
platform darwin -- Python 3.13.11, pytest-9.0.2, pluggy-1.6.0 -- /Users/seshendranalla/Development/kelpie/letta-repo/.venv/bin/python3.13
cachedir: .pytest_cache
metadata: {'Python': '3.13.11', 'Platform': 'macOS-15.3-arm64-arm-64bit-Mach-O', 'Packages': {'pytest': '9.0.2', 'pluggy': '1.6.0'}, 'Plugins': {'anyio': '4.12.1', 'mock': '3.15.1', 'json-report': '1.5.0', 'metadata': '3.1.1', 'order': '1.3.0', 'asyncio': '1.3.0', 'ddtrace': '4.2.2', 'Faker': '40.1.2', 'typeguard': '4.4.4'}, 'JAVA_HOME': '/Library/Java/JavaVirtualMachines/jdk-21.jdk/Contents/Home'}
rootdir: /Users/seshendranalla/Development/kelpie/letta-repo/tests
configfile: pytest.ini
plugins: anyio-4.12.1, mock-3.15.1, json-report-1.5.0, metadata-3.1.1, order-1.3.0, asyncio-1.3.0, ddtrace-4.2.2, Faker-40.1.2, typeguard-4.4.4
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=function, asyncio_default_test_loop_scope=function
collecting ... collected 45 items

tests/sdk/agents_test.py::test_create[caren_agent-params0-extra_expected_values0-None] [2m2026-01-25T16:37:39.786490Z[0m [32m INFO[0m [1mrun[0m[2m:[0m[1mactivate[0m[1m{[0m[3mid[0m[2m=[0mActorId { namespace: "agents", id: "020bc71c-6492-425c-8707-1a71ac9f99f8" } [3mactor_id[0m[2m=[0magents:020bc71c-6492-425c-8707-1a71ac9f99f8[1m}[0m[2m:[0m[1mactivate_with_time[0m[1m{[0m[3mid[0m[2m=[0mActorId { namespace: "agents", id: "020bc71c-6492-425c-8707-1a71ac9f99f8" } [3mactor_id[0m[2m=[0magents:020bc71c-6492-425c-8707-1a71ac9f99f8[1m}[0m[2m:[0m [2mkelpie_runtime::activation[0m[2m:[0m Actor activated [3mactor_id[0m[2m=[0magents:020bc71c-6492-425c-8707-1a71ac9f99f8
[2m2026-01-25T16:37:39.795320Z[0m [32m INFO[0m [1mcreate_agent[0m[1m{[0m[3magent_name[0m[2m=[0mcaren_agent[1m}[0m[2m:[0m [2mkelpie_server::state[0m[2m:[0m agent metadata persisted to storage [3magent_id[0m[2m=[0m020bc71c-6492-425c-8707-1a71ac9f99f8
[2m2026-01-25T16:37:39.807507Z[0m [32m INFO[0m [1mcreate_agent[0m[1m{[0m[3magent_name[0m[2m=[0mcaren_agent[1m}[0m[2m:[0m [2mkelpie_server::api::agents[0m[2m:[0m created agent [3magent_id[0m[2m=[0m020bc71c-6492-425c-8707-1a71ac9f99f8 [3mname[0m[2m=[0mcaren_agent [3mblock_count[0m[2m=[0m0
[2m2026-01-25T16:37:39.823255Z[0m [32m INFO[0m [1mrun[0m[2m:[0m[1mactivate[0m[1m{[0m[3mid[0m[2m=[0mActorId { namespace: "agents", id: "76c8659f-d27c-46a0-98e2-d7fd65288f62" } [3mactor_id[0m[2m=[0magents:76c8659f-d27c-46a0-98e2-d7fd65288f62[1m}[0m[2m:[0m[1mactivate_with_time[0m[1m{[0m[3mid[0m[2m=[0mActorId { namespace: "agents", id: "76c8659f-d27c-46a0-98e2-d7fd65288f62" } [3mactor_id[0m[2m=[0magents:76c8659f-d27c-46a0-98e2-d7fd65288f62[1m}[0m[2m:[0m [2mkelpie_runtime::activation[0m[2m:[0m Actor activated [3mactor_id[0m[2m=[0magents:76c8659f-d27c-46a0-98e2-d7fd65288f62
[2m2026-01-25T16:37:39.830993Z[0m [32m INFO[0m [1mcreate_agent[0m[1m{[0m[3magent_name[0m[2m=[0mcaren[1m}[0m[2m:[0m [2mkelpie_server::state[0m[2m:[0m agent metadata persisted to storage [3magent_id[0m[2m=[0m76c8659f-d27c-46a0-98e2-d7fd65288f62
[2m2026-01-25T16:37:39.837408Z[0m [32m INFO[0m [1mcreate_agent[0m[1m{[0m[3magent_name[0m[2m=[0mcaren[1m}[0m[2m:[0m [2mkelpie_server::api::agents[0m[2m:[0m created agent [3magent_id[0m[2m=[0m76c8659f-d27c-46a0-98e2-d7fd65288f62 [3mname[0m[2m=[0mcaren [3mblock_count[0m[2m=[0m0
PASSED [  2%]
tests/sdk/blocks_test.py::test_create[human_block-params0-extra_expected_values0-None] [2m2026-01-25T16:37:39.839258Z[0m [32m INFO[0m [1mrun[0m[2m:[0m[1mactivate[0m[1m{[0m[3mid[0m[2m=[0mActorId { namespace: "agents", id: "319cd5e1-a22e-47c7-843c-69cd174718bc" } [3mactor_id[0m[2m=[0magents:319cd5e1-a22e-47c7-843c-69cd174718bc[1m}[0m[2m:[0m[1mactivate_with_time[0m[1m{[0m[3mid[0m[2m=[0mActorId { namespace: "agents", id: "319cd5e1-a22e-47c7-843c-69cd174718bc" } [3mactor_id[0m[2m=[0magents:319cd5e1-a22e-47c7-843c-69cd174718bc[1m}[0m[2m:[0m [2mkelpie_runtime::activation[0m[2m:[0m Actor activated [3mactor_id[0m[2m=[0magents:319cd5e1-a22e-47c7-843c-69cd174718bc
[2m2026-01-25T16:37:39.846025Z[0m [32m INFO[0m [1mcreate_agent[0m[1m{[0m[3magent_name[0m[2m=[0mcaren_agent[1m}[0m[2m:[0m [2mkelpie_server::state[0m[2m:[0m agent metadata persisted to storage [3magent_id[0m[2m=[0m319cd5e1-a22e-47c7-843c-69cd174718bc
[2m2026-01-25T16:37:39.852686Z[0m [32m INFO[0m [1mcreate_agent[0m[1m{[0m[3magent_name[0m[2m=[0mcaren_agent[1m}[0m[2m:[0m [2mkelpie_server::api::agents[0m[2m:[0m created agent [3magent_id[0m[2m=[0m319cd5e1-a22e-47c7-843c-69cd174718bc [3mname[0m[2m=[0mcaren_agent [3mblock_count[0m[2m=[0m0
[2m2026-01-25T16:37:39.854055Z[0m [32m INFO[0m [1mcreate_block[0m[1m{[0m[3mlabel[0m[2m=[0mhuman[1m}[0m[2m:[0m [2mkelpie_server::api::standalone_blocks[0m[2m:[0m created standalone block [3mblock_id[0m[2m=[0m9fb0086c-09f4-40e6-a956-bdef086d5f77 [3mlabel[0m[2m=[0mhuman
PASSED [  4%]
tests/sdk/blocks_test.py::test_create[persona_block-params1-extra_expected_values1-None] [2m2026-01-25T16:37:39.856484Z[0m [32m INFO[0m [1mcreate_block[0m[1m{[0m[3mlabel[0m[2m=[0mpersona[1m}[0m[2m:[0m [2mkelpie_server::api::standalone_blocks[0m[2m:[0m created standalone block [3mblock_id[0m[2m=[0mc440d7b9-9594-4a60-88cd-4130223099d2 [3mlabel[0m[2m=[0mpersona
PASSED [  6%]
tests/sdk/tools_test.py::test_create[friendly_func-params0-extra_expected_values0-None] [2m2026-01-25T16:37:39.857838Z[0m [32m INFO[0m [1mrun[0m[2m:[0m[1mactivate[0m[1m{[0m[3mid[0m[2m=[0mActorId { namespace: "agents", id: "baf34ad0-ec6f-4b22-b13c-ac4713d0d705" } [3mactor_id[0m[2m=[0magents:baf34ad0-ec6f-4b22-b13c-ac4713d0d705[1m}[0m[2m:[0m[1mactivate_with_time[0m[1m{[0m[3mid[0m[2m=[0mActorId { namespace: "agents", id: "baf34ad0-ec6f-4b22-b13c-ac4713d0d705" } [3mactor_id[0m[2m=[0magents:baf34ad0-ec6f-4b22-b13c-ac4713d0d705[1m}[0m[2m:[0m [2mkelpie_runtime::activation[0m[2m:[0m Actor activated [3mactor_id[0m[2m=[0magents:baf34ad0-ec6f-4b22-b13c-ac4713d0d705
[2m2026-01-25T16:37:39.866326Z[0m [32m INFO[0m [1mcreate_agent[0m[1m{[0m[3magent_name[0m[2m=[0mcaren_agent[1m}[0m[2m:[0m [2mkelpie_server::state[0m[2m:[0m agent metadata persisted to storage [3magent_id[0m[2m=[0mbaf34ad0-ec6f-4b22-b13c-ac4713d0d705
[2m2026-01-25T16:37:39.873443Z[0m [32m INFO[0m [1mcreate_agent[0m[1m{[0m[3magent_name[0m[2m=[0mcaren_agent[1m}[0m[2m:[0m [2mkelpie_server::api::agents[0m[2m:[0m created agent [3magent_id[0m[2m=[0mbaf34ad0-ec6f-4b22-b13c-ac4713d0d705 [3mname[0m[2m=[0mcaren_agent [3mblock_count[0m[2m=[0m0
[2m2026-01-25T16:37:39.874861Z[0m [32m INFO[0m [1mregister_tool[0m[2m:[0m [2mkelpie_server::state[0m[2m:[0m persisting custom tool to storage [3mname[0m[2m=[0mfriendly_func
[2m2026-01-25T16:37:39.881089Z[0m [32m INFO[0m [1mregister_tool[0m[2m:[0m [2mkelpie_server::state[0m[2m:[0m custom tool persisted successfully [3mname[0m[2m=[0mfriendly_func
[2m2026-01-25T16:37:39.881098Z[0m [32m INFO[0m [1mregister_tool[0m[2m:[0m [2mkelpie_server::api::tools[0m[2m:[0m Registered tool [3mname[0m[2m=[0mfriendly_func
PASSED [  8%]
tests/sdk/tools_test.py::test_create[unfriendly_func-params1-extra_expected_values1-None] [2m2026-01-25T16:37:39.883886Z[0m [32m INFO[0m [1mregister_tool[0m[2m:[0m [2mkelpie_server::state[0m[2m:[0m persisting custom tool to storage [3mname[0m[2m=[0munfriendly_func
[2m2026-01-25T16:37:39.890716Z[0m [32m INFO[0m [1mregister_tool[0m[2m:[0m [2mkelpie_server::state[0m[2m:[0m custom tool persisted successfully [3mname[0m[2m=[0munfriendly_func
[2m2026-01-25T16:37:39.890721Z[0m [32m INFO[0m [1mregister_tool[0m[2m:[0m [2mkelpie_server::api::tools[0m[2m:[0m Registered tool [3mname[0m[2m=[0munfriendly_func
PASSED [ 11%]
tests/sdk/agents_test.py::test_retrieve PASSED                           [ 13%]
tests/sdk/blocks_test.py::test_retrieve PASSED                           [ 15%]
tests/sdk/tools_test.py::test_retrieve PASSED                            [ 17%]
tests/sdk/agents_test.py::test_upsert[NOTSET] SKIPPED (got empty par...) [ 20%]
tests/sdk/blocks_test.py::test_upsert[NOTSET] SKIPPED (got empty par...) [ 22%]
tests/sdk/tools_test.py::test_upsert[unfriendly_func-params0-extra_expected_values0-None] [2m2026-01-25T16:37:39.898547Z[0m [32m INFO[0m [1mupsert_tool[0m[2m:[0m [2mkelpie_server::state[0m[2m:[0m persisting custom tool to storage [3mname[0m[2m=[0munfriendly_func
[2m2026-01-25T16:37:39.905970Z[0m [32m INFO[0m [1mupsert_tool[0m[2m:[0m [2mkelpie_server::state[0m[2m:[0m custom tool persisted successfully [3mname[0m[2m=[0munfriendly_func
[2m2026-01-25T16:37:39.905975Z[0m [32m INFO[0m [1mupsert_tool[0m[2m:[0m [2mkelpie_server::api::tools[0m[2m:[0m Updated tool (upsert) [3mname[0m[2m=[0munfriendly_func
PASSED [ 24%]
tests/sdk/agents_test.py::test_update[caren_agent-params0-extra_expected_values0-None] [2m2026-01-25T16:37:39.907862Z[0m [32m INFO[0m [1mupdate_agent[0m[1m{[0m[3magent_id[0m[2m=[0m76c8659f-d27c-46a0-98e2-d7fd65288f62[1m}[0m[2m:[0m [2mkelpie_server::api::agents[0m[2m:[0m updated agent [3magent_id[0m[2m=[0m76c8659f-d27c-46a0-98e2-d7fd65288f62
PASSED [ 26%]
tests/sdk/blocks_test.py::test_update[human_block-params0-extra_expected_values0-None] [2m2026-01-25T16:37:39.910590Z[0m [32m INFO[0m [1mupdate_block[0m[1m{[0m[3mblock_id[0m[2m=[0m9fb0086c-09f4-40e6-a956-bdef086d5f77[1m}[0m[2m:[0m [2mkelpie_server::api::standalone_blocks[0m[2m:[0m updated standalone block [3mblock_id[0m[2m=[0m9fb0086c-09f4-40e6-a956-bdef086d5f77
PASSED [ 28%]
tests/sdk/blocks_test.py::test_update[persona_block-params1-extra_expected_values1-UnprocessableEntityError] PASSED [ 31%]
tests/sdk/tools_test.py::test_update[friendly_func-params0-extra_expected_values0-None] [2m2026-01-25T16:37:39.914005Z[0m [32m INFO[0m [1mupdate_tool[0m[1m{[0m[3mname_or_id[0m[2m=[0m6251d977-39aa-5afc-938f-219b2a81df16[1m}[0m[2m:[0m [2mkelpie_server::state[0m[2m:[0m persisting custom tool to storage [3mname[0m[2m=[0mfriendly_func
[2m2026-01-25T16:37:39.921324Z[0m [32m INFO[0m [1mupdate_tool[0m[1m{[0m[3mname_or_id[0m[2m=[0m6251d977-39aa-5afc-938f-219b2a81df16[1m}[0m[2m:[0m [2mkelpie_server::state[0m[2m:[0m custom tool persisted successfully [3mname[0m[2m=[0mfriendly_func
[2m2026-01-25T16:37:39.921330Z[0m [32m INFO[0m [1mupdate_tool[0m[1m{[0m[3mname_or_id[0m[2m=[0m6251d977-39aa-5afc-938f-219b2a81df16[1m}[0m[2m:[0m [2mkelpie_server::api::tools[0m[2m:[0m Updated tool (PATCH) [3mname[0m[2m=[0mfriendly_func
PASSED [ 33%]
tests/sdk/tools_test.py::test_update[unfriendly_func-params1-extra_expected_values1-None] [2m2026-01-25T16:37:39.923870Z[0m [32m INFO[0m [1mupdate_tool[0m[1m{[0m[3mname_or_id[0m[2m=[0mda95937d-701e-5a34-ad8f-6288a17e3c5c[1m}[0m[2m:[0m [2mkelpie_server::state[0m[2m:[0m persisting custom tool to storage [3mname[0m[2m=[0munfriendly_func
[2m2026-01-25T16:37:39.931126Z[0m [32m INFO[0m [1mupdate_tool[0m[1m{[0m[3mname_or_id[0m[2m=[0mda95937d-701e-5a34-ad8f-6288a17e3c5c[1m}[0m[2m:[0m [2mkelpie_server::state[0m[2m:[0m custom tool persisted successfully [3mname[0m[2m=[0munfriendly_func
[2m2026-01-25T16:37:39.931132Z[0m [32m INFO[0m [1mupdate_tool[0m[1m{[0m[3mname_or_id[0m[2m=[0mda95937d-701e-5a34-ad8f-6288a17e3c5c[1m}[0m[2m:[0m [2mkelpie_server::api::tools[0m[2m:[0m Updated tool (PATCH) [3mname[0m[2m=[0munfriendly_func
PASSED [ 35%]
tests/sdk/agents_test.py::test_list[query_params0-1] [2m2026-01-25T16:37:39.935154Z[0m [32m INFO[0m [1mlist_agents[0m[1m{[0m[3mlimit[0m[2m=[0m50 [3mcursor[0m[2m=[0mNone [3mafter[0m[2m=[0mNone[1m}[0m[2m:[0m [2mkelpie_server::storage::fdb[0m[2m:[0m list_agents complete [3magent_count[0m[2m=[0m90
[2m2026-01-25T16:37:40.000766Z[0m [32m INFO[0m [1mlist_agents[0m[1m{[0m[3mlimit[0m[2m=[0m50 [3mcursor[0m[2m=[0mNone [3mafter[0m[2m=[0mNone[1m}[0m[2m:[0m [2mkelpie_server::storage::fdb[0m[2m:[0m list_agents complete [3magent_count[0m[2m=[0m90
[2m2026-01-25T16:37:40.009024Z[0m [32m INFO[0m [1mlist_agents[0m[1m{[0m[3mlimit[0m[2m=[0m50 [3mcursor[0m[2m=[0mNone [3mafter[0m[2m=[0mSome("16220878-55ee-4644-8beb-0379a599a6aa")[1m}[0m[2m:[0m [2mkelpie_server::storage::fdb[0m[2m:[0m list_agents complete [3magent_count[0m[2m=[0m90
[2m2026-01-25T16:37:40.071532Z[0m [32m INFO[0m [1mlist_agents[0m[1m{[0m[3mlimit[0m[2m=[0m50 [3mcursor[0m[2m=[0mNone [3mafter[0m[2m=[0mSome("16220878-55ee-4644-8beb-0379a599a6aa")[1m}[0m[2m:[0m [2mkelpie_server::storage::fdb[0m[2m:[0m list_agents complete [3magent_count[0m[2m=[0m90
[2m2026-01-25T16:37:40.076503Z[0m [32m INFO[0m [1mlist_agents[0m[1m{[0m[3mlimit[0m[2m=[0m50 [3mcursor[0m[2m=[0mNone [3mafter[0m[2m=[0mSome("1a8e71f5-cdb4-4eed-a0f9-d132bf1e636e")[1m}[0m[2m:[0m [2mkelpie_server::storage::fdb[0m[2m:[0m list_agents complete [3magent_count[0m[2m=[0m90
[2m2026-01-25T16:37:40.133682Z[0m [32m INFO[0m [1mlist_agents[0m[1m{[0m[3mlimit[0m[2m=[0m50 [3mcursor[0m[2m=[0mNone [3mafter[0m[2m=[0mSome("1a8e71f5-cdb4-4eed-a0f9-d132bf1e636e")[1m}[0m[2m:[0m [2mkelpie_server::storage::fdb[0m[2m:[0m list_agents complete [3magent_count[0m[2m=[0m90
FAILED              [ 37%]
tests/sdk/agents_test.py::test_list[query_params1-1] [2m2026-01-25T16:37:40.209060Z[0m [32m INFO[0m [1mlist_agents[0m[1m{[0m[3mlimit[0m[2m=[0m50 [3mcursor[0m[2m=[0mNone [3mafter[0m[2m=[0mNone[1m}[0m[2m:[0m [2mkelpie_server::storage::fdb[0m[2m:[0m list_agents complete [3magent_count[0m[2m=[0m90
[2m2026-01-25T16:37:40.262479Z[0m [32m INFO[0m [1mlist_agents[0m[1m{[0m[3mlimit[0m[2m=[0m50 [3mcursor[0m[2m=[0mNone [3mafter[0m[2m=[0mNone[1m}[0m[2m:[0m [2mkelpie_server::storage::fdb[0m[2m:[0m list_agents complete [3magent_count[0m[2m=[0m90
FAILED              [ 40%]
tests/sdk/blocks_test.py::test_list[query_params0-2] PASSED              [ 42%]
tests/sdk/blocks_test.py::test_list[query_params1-1] PASSED              [ 44%]
tests/sdk/blocks_test.py::test_list[query_params2-1] PASSED              [ 46%]
tests/sdk/tools_test.py::test_list[query_params0-2] [2m2026-01-25T16:37:40.272253Z[0m [32m INFO[0m [1mlist_tools[0m[1m{[0m[3mquery[0m[2m=[0mListToolsQuery { name: None, id: None, after: None }[1m}[0m[2m:[0m [2mkelpie_server::api::tools[0m[2m:[0m list_tools called with query params [3mquery[0m[2m=[0mListToolsQuery { name: None, id: None, after: None }
[2m2026-01-25T16:37:40.272280Z[0m [32m INFO[0m [1mlist_tools[0m[1m{[0m[3mquery[0m[2m=[0mListToolsQuery { name: None, id: None, after: None }[1m}[0m[2m:[0m [2mkelpie_server::api::tools[0m[2m:[0m list_tools retrieved from state [3mtotal_tools[0m[2m=[0m19 [3mtool_names[0m[2m=[0m["friendly_func", "unfriendly_func", "archival_memory_insert", "debug_test", "conversation_search_date", "fdb_persist_test", "persist_test_v3", "persist_test_v2", "pause_heartbeats", "conversation_search", "run_code", "test_tool", "archival_memory_search", "shell", "core_memory_append", "final_test_tool", "send_message", "core_memory_replace", "web_search"]
[2m2026-01-25T16:37:40.273467Z[0m [32m INFO[0m [1mlist_tools[0m[1m{[0m[3mquery[0m[2m=[0mListToolsQuery { name: None, id: None, after: Some("f602eda6-83fa-50f3-a2c6-5ec2d68dfc31") }[1m}[0m[2m:[0m [2mkelpie_server::api::tools[0m[2m:[0m list_tools called with query params [3mquery[0m[2m=[0mListToolsQuery { name: None, id: None, after: Some("f602eda6-83fa-50f3-a2c6-5ec2d68dfc31") }
[2m2026-01-25T16:37:40.273494Z[0m [32m INFO[0m [1mlist_tools[0m[1m{[0m[3mquery[0m[2m=[0mListToolsQuery { name: None, id: None, after: Some("f602eda6-83fa-50f3-a2c6-5ec2d68dfc31") }[1m}[0m[2m:[0m [2mkelpie_server::api::tools[0m[2m:[0m list_tools retrieved from state [3mtotal_tools[0m[2m=[0m19 [3mtool_names[0m[2m=[0m["friendly_func", "unfriendly_func", "archival_memory_insert", "debug_test", "conversation_search_date", "fdb_persist_test", "persist_test_v3", "persist_test_v2", "pause_heartbeats", "conversation_search", "run_code", "test_tool", "archival_memory_search", "shell", "core_memory_append", "final_test_tool", "send_message", "core_memory_replace", "web_search"]
[2m2026-01-25T16:37:40.273498Z[0m [32m INFO[0m [1mlist_tools[0m[1m{[0m[3mquery[0m[2m=[0mListToolsQuery { name: None, id: None, after: Some("f602eda6-83fa-50f3-a2c6-5ec2d68dfc31") }[1m}[0m[2m:[0m [2mkelpie_server::api::tools[0m[2m:[0m Pagination: searching for cursor in sorted list [3mcursor_id[0m[2m=[0mf602eda6-83fa-50f3-a2c6-5ec2d68dfc31 [3mall_ids[0m[2m=[0m["0a507825-2ada-5ede-adff-a5d8f7955a78", "17681a4c-9289-5204-ae58-0dab5194355f", "19e174fc-86be-53a9-97ca-b84b032117da", "2d8d079c-2379-534d-8f31-707e78e52285", "30c68c9a-baa6-5348-a993-f577f948a989", "4d2d7542-d2b7-58c8-95fe-8abe9decb9a2", "5148cef5-f699-5526-9e46-6b660439cb1a", "580e9571-e5e9-5f74-9a1e-6f1b1a8800e0", "5dcb78bc-10c8-5fe5-a481-0f049a3cffd2", "61ef39ec-7457-56a5-b7a9-a4d7f8a2fb92", "6251d977-39aa-5afc-938f-219b2a81df16", "724b54ac-aacc-53ea-950c-eaf60f942b76", "87f88667-3cc6-50bd-9081-0dabbb86e24a", "99dc151c-86e4-5690-8776-3f25a0022351", "c7d905bb-0542-5d30-b67a-7909fb0d7574", "d5e5eed2-6d00-55cb-b157-ceca44bc8044", "da95937d-701e-5a34-ad8f-6288a17e3c5c", "e2ddd80e-04b1-5c15-8370-b6b578b11e85", "f602eda6-83fa-50f3-a2c6-5ec2d68dfc31"] [3mfiltered_count[0m[2m=[0m19
[2m2026-01-25T16:37:40.273502Z[0m [32m INFO[0m [1mlist_tools[0m[1m{[0m[3mquery[0m[2m=[0mListToolsQuery { name: None, id: None, after: Some("f602eda6-83fa-50f3-a2c6-5ec2d68dfc31") }[1m}[0m[2m:[0m [2mkelpie_server::api::tools[0m[2m:[0m Found cursor at position [3mcursor_pos[0m[2m=[0m18
PASSED               [ 48%]
tests/sdk/tools_test.py::test_list[query_params1-1] [2m2026-01-25T16:37:40.274805Z[0m [32m INFO[0m [1mlist_tools[0m[1m{[0m[3mquery[0m[2m=[0mListToolsQuery { name: Some("friendly_func"), id: None, after: None }[1m}[0m[2m:[0m [2mkelpie_server::api::tools[0m[2m:[0m list_tools called with query params [3mquery[0m[2m=[0mListToolsQuery { name: Some("friendly_func"), id: None, after: None }
[2m2026-01-25T16:37:40.274821Z[0m [32m INFO[0m [1mlist_tools[0m[1m{[0m[3mquery[0m[2m=[0mListToolsQuery { name: Some("friendly_func"), id: None, after: None }[1m}[0m[2m:[0m [2mkelpie_server::api::tools[0m[2m:[0m list_tools retrieved from state [3mtotal_tools[0m[2m=[0m19 [3mtool_names[0m[2m=[0m["friendly_func", "unfriendly_func", "archival_memory_insert", "debug_test", "conversation_search_date", "fdb_persist_test", "persist_test_v3", "persist_test_v2", "pause_heartbeats", "conversation_search", "run_code", "test_tool", "archival_memory_search", "shell", "core_memory_append", "final_test_tool", "send_message", "core_memory_replace", "web_search"]
[2m2026-01-25T16:37:40.275407Z[0m [32m INFO[0m [1mlist_tools[0m[1m{[0m[3mquery[0m[2m=[0mListToolsQuery { name: Some("friendly_func"), id: None, after: Some("6251d977-39aa-5afc-938f-219b2a81df16") }[1m}[0m[2m:[0m [2mkelpie_server::api::tools[0m[2m:[0m list_tools called with query params [3mquery[0m[2m=[0mListToolsQuery { name: Some("friendly_func"), id: None, after: Some("6251d977-39aa-5afc-938f-219b2a81df16") }
[2m2026-01-25T16:37:40.275427Z[0m [32m INFO[0m [1mlist_tools[0m[1m{[0m[3mquery[0m[2m=[0mListToolsQuery { name: Some("friendly_func"), id: None, after: Some("6251d977-39aa-5afc-938f-219b2a81df16") }[1m}[0m[2m:[0m [2mkelpie_server::api::tools[0m[2m:[0m list_tools retrieved from state [3mtotal_tools[0m[2m=[0m19 [3mtool_names[0m[2m=[0m["friendly_func", "unfriendly_func", "archival_memory_insert", "debug_test", "conversation_search_date", "fdb_persist_test", "persist_test_v3", "persist_test_v2", "pause_heartbeats", "conversation_search", "run_code", "test_tool", "archival_memory_search", "shell", "core_memory_append", "final_test_tool", "send_message", "core_memory_replace", "web_search"]
[2m2026-01-25T16:37:40.275440Z[0m [32m INFO[0m [1mlist_tools[0m[1m{[0m[3mquery[0m[2m=[0mListToolsQuery { name: Some("friendly_func"), id: None, after: Some("6251d977-39aa-5afc-938f-219b2a81df16") }[1m}[0m[2m:[0m [2mkelpie_server::api::tools[0m[2m:[0m Pagination: searching for cursor in sorted list [3mcursor_id[0m[2m=[0m6251d977-39aa-5afc-938f-219b2a81df16 [3mall_ids[0m[2m=[0m["6251d977-39aa-5afc-938f-219b2a81df16"] [3mfiltered_count[0m[2m=[0m1
[2m2026-01-25T16:37:40.275442Z[0m [32m INFO[0m [1mlist_tools[0m[1m{[0m[3mquery[0m[2m=[0mListToolsQuery { name: Some("friendly_func"), id: None, after: Some("6251d977-39aa-5afc-938f-219b2a81df16") }[1m}[0m[2m:[0m [2mkelpie_server::api::tools[0m[2m:[0m Found cursor at position [3mcursor_pos[0m[2m=[0m0
PASSED               [ 51%]
tests/sdk/mcp_servers_test.py::test_create_stdio_mcp_server [2m2026-01-25T16:37:40.288453Z[0m [32m INFO[0m [1mcreate_server[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Created MCP server [3mserver_id[0m[2m=[0mmcp_server-d617a227-2cc4-40c9-b5d6-30e4d93a643a [3mserver_name[0m[2m=[0mtest-stdio-0e4bd0d3
[2m2026-01-25T16:37:40.288513Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mtest-stdio-0e4bd0d3
[2m2026-01-25T16:37:40.288516Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0mnpx [3margs[0m[2m=[0m["-y", "@modelcontextprotocol/server-everything"]
[2m2026-01-25T16:37:40.289907Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-d617a227-2cc4-40c9-b5d6-30e4d93a643a[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Disconnected MCP client and unregistered tools [3mserver_id[0m[2m=[0mmcp_server-d617a227-2cc4-40c9-b5d6-30e4d93a643a [3mserver_name[0m[2m=[0mtest-stdio-0e4bd0d3
[2m2026-01-25T16:37:40.298478Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-d617a227-2cc4-40c9-b5d6-30e4d93a643a[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Deleted MCP server [3mserver_id[0m[2m=[0mmcp_server-d617a227-2cc4-40c9-b5d6-30e4d93a643a
PASSED       [ 53%]
tests/sdk/mcp_servers_test.py::test_create_sse_mcp_server [2m2026-01-25T16:37:40.306905Z[0m [32m INFO[0m [1mcreate_server[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Created MCP server [3mserver_id[0m[2m=[0mmcp_server-6b49922c-9fae-4beb-b7a6-90bd017b7059 [3mserver_name[0m[2m=[0mtest-sse-ab962749
[2m2026-01-25T16:37:40.306932Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mtest-sse-ab962749
[2m2026-01-25T16:37:40.306935Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to SSE MCP server [3murl[0m[2m=[0mhttps://api.example.com/sse
[2m2026-01-25T16:37:40.307714Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6b49922c-9fae-4beb-b7a6-90bd017b7059[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Disconnected MCP client and unregistered tools [3mserver_id[0m[2m=[0mmcp_server-6b49922c-9fae-4beb-b7a6-90bd017b7059 [3mserver_name[0m[2m=[0mtest-sse-ab962749
[2m2026-01-25T16:37:40.315739Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6b49922c-9fae-4beb-b7a6-90bd017b7059[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Deleted MCP server [3mserver_id[0m[2m=[0mmcp_server-6b49922c-9fae-4beb-b7a6-90bd017b7059
PASSED         [ 55%]
tests/sdk/mcp_servers_test.py::test_create_streamable_http_mcp_server [2m2026-01-25T16:37:40.338349Z[0m [32m INFO[0m [1mcreate_server[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Created MCP server [3mserver_id[0m[2m=[0mmcp_server-d52936ce-d6a2-4eea-a4fd-078f44ee3d23 [3mserver_name[0m[2m=[0mtest-http-d528947c
[2m2026-01-25T16:37:40.338393Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mtest-http-d528947c
[2m2026-01-25T16:37:40.338396Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to HTTP MCP server [3murl[0m[2m=[0mhttps://api.example.com/streamable
[2m2026-01-25T16:37:40.339441Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-d52936ce-d6a2-4eea-a4fd-078f44ee3d23[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Disconnected MCP client and unregistered tools [3mserver_id[0m[2m=[0mmcp_server-d52936ce-d6a2-4eea-a4fd-078f44ee3d23 [3mserver_name[0m[2m=[0mtest-http-d528947c
[2m2026-01-25T16:37:40.345441Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-d52936ce-d6a2-4eea-a4fd-078f44ee3d23[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Deleted MCP server [3mserver_id[0m[2m=[0mmcp_server-d52936ce-d6a2-4eea-a4fd-078f44ee3d23
PASSED [ 57%]
tests/sdk/mcp_servers_test.py::test_list_mcp_servers [2m2026-01-25T16:37:40.349175Z[0m [33m WARN[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Failed to connect to MCP server or discover tools [3mserver_id[0m[2m=[0mmcp_server-d52936ce-d6a2-4eea-a4fd-078f44ee3d23 [3mserver_name[0m[2m=[0mtest-http-d528947c [3merror[0m[2m=[0mFailed to connect to MCP server 'test-http-d528947c': MCP connection error: HTTP request failed: error sending request for url (https://api.example.com/streamable)
[2m2026-01-25T16:37:40.349191Z[0m [33m WARN[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Failed to connect to MCP server or discover tools [3mserver_id[0m[2m=[0mmcp_server-6b49922c-9fae-4beb-b7a6-90bd017b7059 [3mserver_name[0m[2m=[0mtest-sse-ab962749 [3merror[0m[2m=[0mFailed to connect to MCP server 'test-sse-ab962749': MCP connection error: HTTP request failed: error sending request for url (https://api.example.com/sse)
[2m2026-01-25T16:37:40.349233Z[0m [31mERROR[0m [2mkelpie_tools::mcp[0m[2m:[0m SSE error [3merror[0m[2m=[0merror sending request for url (https://api.example.com/sse/sse)
[2m2026-01-25T16:37:40.353886Z[0m [32m INFO[0m [1mcreate_server[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Created MCP server [3mserver_id[0m[2m=[0mmcp_server-e2cdcbb9-df6c-473f-99b5-636f4e08b0bb [3mserver_name[0m[2m=[0mlist-test-stdio-94e1399f
[2m2026-01-25T16:37:40.353920Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mlist-test-stdio-94e1399f
[2m2026-01-25T16:37:40.353924Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0mnpx [3margs[0m[2m=[0m["-y", "@modelcontextprotocol/server-everything"]
[2m2026-01-25T16:37:40.369414Z[0m [32m INFO[0m [1mcreate_server[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Created MCP server [3mserver_id[0m[2m=[0mmcp_server-16bd1437-0dad-429a-b03a-4d46c30541ea [3mserver_name[0m[2m=[0mlist-test-sse-4abd26ca
[2m2026-01-25T16:37:40.369457Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mlist-test-sse-4abd26ca
[2m2026-01-25T16:37:40.369461Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to SSE MCP server [3murl[0m[2m=[0mhttps://api.example.com/sse
[2m2026-01-25T16:37:40.371008Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-e2cdcbb9-df6c-473f-99b5-636f4e08b0bb[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Disconnected MCP client and unregistered tools [3mserver_id[0m[2m=[0mmcp_server-e2cdcbb9-df6c-473f-99b5-636f4e08b0bb [3mserver_name[0m[2m=[0mlist-test-stdio-94e1399f
[2m2026-01-25T16:37:40.371601Z[0m [33m WARN[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Failed to connect to MCP server or discover tools [3mserver_id[0m[2m=[0mmcp_server-16bd1437-0dad-429a-b03a-4d46c30541ea [3mserver_name[0m[2m=[0mlist-test-sse-4abd26ca [3merror[0m[2m=[0mFailed to connect to MCP server 'list-test-sse-4abd26ca': MCP connection error: HTTP request failed: error sending request for url (https://api.example.com/sse)
[2m2026-01-25T16:37:40.377656Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-e2cdcbb9-df6c-473f-99b5-636f4e08b0bb[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Deleted MCP server [3mserver_id[0m[2m=[0mmcp_server-e2cdcbb9-df6c-473f-99b5-636f4e08b0bb
[2m2026-01-25T16:37:40.378439Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-16bd1437-0dad-429a-b03a-4d46c30541ea[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Disconnected MCP client and unregistered tools [3mserver_id[0m[2m=[0mmcp_server-16bd1437-0dad-429a-b03a-4d46c30541ea [3mserver_name[0m[2m=[0mlist-test-sse-4abd26ca
[2m2026-01-25T16:37:40.384388Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-16bd1437-0dad-429a-b03a-4d46c30541ea[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Deleted MCP server [3mserver_id[0m[2m=[0mmcp_server-16bd1437-0dad-429a-b03a-4d46c30541ea
PASSED              [ 60%]
tests/sdk/mcp_servers_test.py::test_get_specific_mcp_server [2m2026-01-25T16:37:40.406358Z[0m [32m INFO[0m [1mcreate_server[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Created MCP server [3mserver_id[0m[2m=[0mmcp_server-e5b6aba6-6b99-485d-8914-5ae8f745a38e [3mserver_name[0m[2m=[0mget-test-eeecad21
[2m2026-01-25T16:37:40.406394Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mget-test-eeecad21
[2m2026-01-25T16:37:40.406398Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0mpython [3margs[0m[2m=[0m["-m", "mcp_server"]
[2m2026-01-25T16:37:40.407149Z[0m [33m WARN[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Failed to connect to MCP server or discover tools [3mserver_id[0m[2m=[0mmcp_server-e5b6aba6-6b99-485d-8914-5ae8f745a38e [3mserver_name[0m[2m=[0mget-test-eeecad21 [3merror[0m[2m=[0mFailed to connect to MCP server 'get-test-eeecad21': MCP connection error: failed to spawn MCP server 'python': No such file or directory (os error 2)
[2m2026-01-25T16:37:40.407945Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-e5b6aba6-6b99-485d-8914-5ae8f745a38e[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Disconnected MCP client and unregistered tools [3mserver_id[0m[2m=[0mmcp_server-e5b6aba6-6b99-485d-8914-5ae8f745a38e [3mserver_name[0m[2m=[0mget-test-eeecad21
[2m2026-01-25T16:37:40.415314Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-e5b6aba6-6b99-485d-8914-5ae8f745a38e[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Deleted MCP server [3mserver_id[0m[2m=[0mmcp_server-e5b6aba6-6b99-485d-8914-5ae8f745a38e
PASSED       [ 62%]
tests/sdk/mcp_servers_test.py::test_update_stdio_mcp_server [2m2026-01-25T16:37:40.427784Z[0m [32m INFO[0m [1mcreate_server[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Created MCP server [3mserver_id[0m[2m=[0mmcp_server-0c26a6bc-85a2-4bfc-aa1a-a376ed0c9140 [3mserver_name[0m[2m=[0mupdate-test-stdio-861044ee
[2m2026-01-25T16:37:40.427828Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mupdate-test-stdio-861044ee
[2m2026-01-25T16:37:40.427830Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0mnode [3margs[0m[2m=[0m["old_server.js"]
[2m2026-01-25T16:37:40.435381Z[0m [32m INFO[0m [1mupdate_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-0c26a6bc-85a2-4bfc-aa1a-a376ed0c9140[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Updated MCP server [3mserver_id[0m[2m=[0mmcp_server-0c26a6bc-85a2-4bfc-aa1a-a376ed0c9140
[2m2026-01-25T16:37:40.436160Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-0c26a6bc-85a2-4bfc-aa1a-a376ed0c9140[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Disconnected MCP client and unregistered tools [3mserver_id[0m[2m=[0mmcp_server-0c26a6bc-85a2-4bfc-aa1a-a376ed0c9140 [3mserver_name[0m[2m=[0mupdated-stdio-server
[2m2026-01-25T16:37:40.442973Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-0c26a6bc-85a2-4bfc-aa1a-a376ed0c9140[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Deleted MCP server [3mserver_id[0m[2m=[0mmcp_server-0c26a6bc-85a2-4bfc-aa1a-a376ed0c9140
PASSED       [ 64%]
tests/sdk/mcp_servers_test.py::test_update_sse_mcp_server [2m2026-01-25T16:37:40.452479Z[0m [32m INFO[0m [1mcreate_server[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Created MCP server [3mserver_id[0m[2m=[0mmcp_server-d8aa30dd-c729-4abd-a7d1-b21761af7ae0 [3mserver_name[0m[2m=[0mupdate-test-sse-1e671c53
[2m2026-01-25T16:37:40.452539Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mupdate-test-sse-1e671c53
[2m2026-01-25T16:37:40.452542Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to SSE MCP server [3murl[0m[2m=[0mhttps://old.example.com/sse
[2m2026-01-25T16:37:40.461665Z[0m [32m INFO[0m [1mupdate_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-d8aa30dd-c729-4abd-a7d1-b21761af7ae0[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Updated MCP server [3mserver_id[0m[2m=[0mmcp_server-d8aa30dd-c729-4abd-a7d1-b21761af7ae0
[2m2026-01-25T16:37:40.462536Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-d8aa30dd-c729-4abd-a7d1-b21761af7ae0[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Disconnected MCP client and unregistered tools [3mserver_id[0m[2m=[0mmcp_server-d8aa30dd-c729-4abd-a7d1-b21761af7ae0 [3mserver_name[0m[2m=[0mupdated-sse-server
[2m2026-01-25T16:37:40.469764Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-d8aa30dd-c729-4abd-a7d1-b21761af7ae0[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Deleted MCP server [3mserver_id[0m[2m=[0mmcp_server-d8aa30dd-c729-4abd-a7d1-b21761af7ae0
PASSED         [ 66%]
tests/sdk/mcp_servers_test.py::test_delete_mcp_server [2m2026-01-25T16:37:40.477925Z[0m [32m INFO[0m [1mcreate_server[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Created MCP server [3mserver_id[0m[2m=[0mmcp_server-209a2dd0-f4de-46e9-8737-34e912c50f2e [3mserver_name[0m[2m=[0mdelete-test-897ef93c
[2m2026-01-25T16:37:40.477956Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mdelete-test-897ef93c
[2m2026-01-25T16:37:40.477959Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0mnpx [3margs[0m[2m=[0m["-y", "@modelcontextprotocol/server-everything"]
[2m2026-01-25T16:37:40.478919Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-209a2dd0-f4de-46e9-8737-34e912c50f2e[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Disconnected MCP client and unregistered tools [3mserver_id[0m[2m=[0mmcp_server-209a2dd0-f4de-46e9-8737-34e912c50f2e [3mserver_name[0m[2m=[0mdelete-test-897ef93c
[2m2026-01-25T16:37:40.482966Z[0m [31mERROR[0m [2mkelpie_tools::mcp[0m[2m:[0m SSE error [3merror[0m[2m=[0merror sending request for url (https://old.example.com/sse/sse)
[2m2026-01-25T16:37:40.482970Z[0m [33m WARN[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Failed to connect to MCP server or discover tools [3mserver_id[0m[2m=[0mmcp_server-d8aa30dd-c729-4abd-a7d1-b21761af7ae0 [3mserver_name[0m[2m=[0mupdate-test-sse-1e671c53 [3merror[0m[2m=[0mFailed to connect to MCP server 'update-test-sse-1e671c53': MCP connection error: HTTP request failed: error sending request for url (https://old.example.com/sse)
[2m2026-01-25T16:37:40.486434Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-209a2dd0-f4de-46e9-8737-34e912c50f2e[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Deleted MCP server [3mserver_id[0m[2m=[0mmcp_server-209a2dd0-f4de-46e9-8737-34e912c50f2e
PASSED             [ 68%]
tests/sdk/mcp_servers_test.py::test_invalid_server_type PASSED           [ 71%]
tests/sdk/mcp_servers_test.py::test_multiple_server_types_coexist [2m2026-01-25T16:37:40.496665Z[0m [32m INFO[0m [1mcreate_server[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Created MCP server [3mserver_id[0m[2m=[0mmcp_server-3c0cd1a7-c1e4-42cf-a755-cec42ca78838 [3mserver_name[0m[2m=[0mmulti-stdio-766d2b9a
[2m2026-01-25T16:37:40.496701Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mmulti-stdio-766d2b9a
[2m2026-01-25T16:37:40.496703Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0mnpx [3margs[0m[2m=[0m["-y", "@modelcontextprotocol/server-everything"]
[2m2026-01-25T16:37:40.504435Z[0m [32m INFO[0m [1mcreate_server[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Created MCP server [3mserver_id[0m[2m=[0mmcp_server-c89b0f78-4cfb-455f-9aa9-fd980326a2d7 [3mserver_name[0m[2m=[0mmulti-sse-d4e984c1
[2m2026-01-25T16:37:40.504464Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mmulti-sse-d4e984c1
[2m2026-01-25T16:37:40.504467Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to SSE MCP server [3murl[0m[2m=[0mhttps://api.example.com/sse
[2m2026-01-25T16:37:40.506883Z[0m [33m WARN[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Failed to connect to MCP server or discover tools [3mserver_id[0m[2m=[0mmcp_server-c89b0f78-4cfb-455f-9aa9-fd980326a2d7 [3mserver_name[0m[2m=[0mmulti-sse-d4e984c1 [3merror[0m[2m=[0mFailed to connect to MCP server 'multi-sse-d4e984c1': MCP connection error: HTTP request failed: error sending request for url (https://api.example.com/sse)
[2m2026-01-25T16:37:40.512969Z[0m [32m INFO[0m [1mcreate_server[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Created MCP server [3mserver_id[0m[2m=[0mmcp_server-bcee57de-ac28-4713-b555-c89b6459915d [3mserver_name[0m[2m=[0mmulti-http-5d033c3a
[2m2026-01-25T16:37:40.513001Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mmulti-http-5d033c3a
[2m2026-01-25T16:37:40.513004Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to HTTP MCP server [3murl[0m[2m=[0mhttps://api.example.com/streamable
[2m2026-01-25T16:37:40.516695Z[0m [33m WARN[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Failed to connect to MCP server or discover tools [3mserver_id[0m[2m=[0mmcp_server-bcee57de-ac28-4713-b555-c89b6459915d [3mserver_name[0m[2m=[0mmulti-http-5d033c3a [3merror[0m[2m=[0mFailed to connect to MCP server 'multi-http-5d033c3a': MCP connection error: HTTP request failed: error sending request for url (https://api.example.com/streamable)
[2m2026-01-25T16:37:40.516811Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-3c0cd1a7-c1e4-42cf-a755-cec42ca78838[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Disconnected MCP client and unregistered tools [3mserver_id[0m[2m=[0mmcp_server-3c0cd1a7-c1e4-42cf-a755-cec42ca78838 [3mserver_name[0m[2m=[0mmulti-stdio-766d2b9a
[2m2026-01-25T16:37:40.545205Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-3c0cd1a7-c1e4-42cf-a755-cec42ca78838[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Deleted MCP server [3mserver_id[0m[2m=[0mmcp_server-3c0cd1a7-c1e4-42cf-a755-cec42ca78838
[2m2026-01-25T16:37:40.546302Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-c89b0f78-4cfb-455f-9aa9-fd980326a2d7[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Disconnected MCP client and unregistered tools [3mserver_id[0m[2m=[0mmcp_server-c89b0f78-4cfb-455f-9aa9-fd980326a2d7 [3mserver_name[0m[2m=[0mmulti-sse-d4e984c1
[2m2026-01-25T16:37:40.557738Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-c89b0f78-4cfb-455f-9aa9-fd980326a2d7[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Deleted MCP server [3mserver_id[0m[2m=[0mmcp_server-c89b0f78-4cfb-455f-9aa9-fd980326a2d7
[2m2026-01-25T16:37:40.558525Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-bcee57de-ac28-4713-b555-c89b6459915d[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Disconnected MCP client and unregistered tools [3mserver_id[0m[2m=[0mmcp_server-bcee57de-ac28-4713-b555-c89b6459915d [3mserver_name[0m[2m=[0mmulti-http-5d033c3a
[2m2026-01-25T16:37:40.569467Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-bcee57de-ac28-4713-b555-c89b6459915d[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Deleted MCP server [3mserver_id[0m[2m=[0mmcp_server-bcee57de-ac28-4713-b555-c89b6459915d
PASSED [ 73%]
tests/sdk/mcp_servers_test.py::test_partial_update_preserves_fields [2m2026-01-25T16:37:40.578981Z[0m [32m INFO[0m [1mcreate_server[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Created MCP server [3mserver_id[0m[2m=[0mmcp_server-e05f6a7b-d4bb-47da-be84-461c2b0da6ad [3mserver_name[0m[2m=[0mpartial-update-3fd93bf0
[2m2026-01-25T16:37:40.579015Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mpartial-update-3fd93bf0
[2m2026-01-25T16:37:40.579022Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0mnode [3margs[0m[2m=[0m["server.js", "--port", "3000"]
[2m2026-01-25T16:37:40.588449Z[0m [32m INFO[0m [1mupdate_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-e05f6a7b-d4bb-47da-be84-461c2b0da6ad[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Updated MCP server [3mserver_id[0m[2m=[0mmcp_server-e05f6a7b-d4bb-47da-be84-461c2b0da6ad
[2m2026-01-25T16:37:40.589337Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-e05f6a7b-d4bb-47da-be84-461c2b0da6ad[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Disconnected MCP client and unregistered tools [3mserver_id[0m[2m=[0mmcp_server-e05f6a7b-d4bb-47da-be84-461c2b0da6ad [3mserver_name[0m[2m=[0mrenamed-server
[2m2026-01-25T16:37:40.596640Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-e05f6a7b-d4bb-47da-be84-461c2b0da6ad[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Deleted MCP server [3mserver_id[0m[2m=[0mmcp_server-e05f6a7b-d4bb-47da-be84-461c2b0da6ad
PASSED [ 75%]
tests/sdk/mcp_servers_test.py::test_concurrent_server_operations [2m2026-01-25T16:37:40.606379Z[0m [32m INFO[0m [1mcreate_server[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Created MCP server [3mserver_id[0m[2m=[0mmcp_server-2375793e-61fd-41f5-9dbe-73a9f2ed2204 [3mserver_name[0m[2m=[0mconcurrent-0-8b3ed446
[2m2026-01-25T16:37:40.606426Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mconcurrent-0-8b3ed446
[2m2026-01-25T16:37:40.606430Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0mpython [3margs[0m[2m=[0m["server_0.py"]
[2m2026-01-25T16:37:40.608030Z[0m [33m WARN[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Failed to connect to MCP server or discover tools [3mserver_id[0m[2m=[0mmcp_server-2375793e-61fd-41f5-9dbe-73a9f2ed2204 [3mserver_name[0m[2m=[0mconcurrent-0-8b3ed446 [3merror[0m[2m=[0mFailed to connect to MCP server 'concurrent-0-8b3ed446': MCP connection error: failed to spawn MCP server 'python': No such file or directory (os error 2)
[2m2026-01-25T16:37:40.616981Z[0m [32m INFO[0m [1mcreate_server[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Created MCP server [3mserver_id[0m[2m=[0mmcp_server-e400971a-b451-4e2c-8f3d-a1794fec177f [3mserver_name[0m[2m=[0mconcurrent-1-252cac7f
[2m2026-01-25T16:37:40.617020Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mconcurrent-1-252cac7f
[2m2026-01-25T16:37:40.617023Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0mpython [3margs[0m[2m=[0m["server_1.py"]
[2m2026-01-25T16:37:40.617908Z[0m [33m WARN[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Failed to connect to MCP server or discover tools [3mserver_id[0m[2m=[0mmcp_server-e400971a-b451-4e2c-8f3d-a1794fec177f [3mserver_name[0m[2m=[0mconcurrent-1-252cac7f [3merror[0m[2m=[0mFailed to connect to MCP server 'concurrent-1-252cac7f': MCP connection error: failed to spawn MCP server 'python': No such file or directory (os error 2)
[2m2026-01-25T16:37:40.626430Z[0m [32m INFO[0m [1mcreate_server[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Created MCP server [3mserver_id[0m[2m=[0mmcp_server-52cfb1fa-026b-4790-ae87-b65c1bbf9b6e [3mserver_name[0m[2m=[0mconcurrent-2-8a3dbc41
[2m2026-01-25T16:37:40.626478Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mconcurrent-2-8a3dbc41
[2m2026-01-25T16:37:40.626481Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0mpython [3margs[0m[2m=[0m["server_2.py"]
[2m2026-01-25T16:37:40.627434Z[0m [33m WARN[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Failed to connect to MCP server or discover tools [3mserver_id[0m[2m=[0mmcp_server-52cfb1fa-026b-4790-ae87-b65c1bbf9b6e [3mserver_name[0m[2m=[0mconcurrent-2-8a3dbc41 [3merror[0m[2m=[0mFailed to connect to MCP server 'concurrent-2-8a3dbc41': MCP connection error: failed to spawn MCP server 'python': No such file or directory (os error 2)
[2m2026-01-25T16:37:40.634711Z[0m [32m INFO[0m [1mupdate_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-2375793e-61fd-41f5-9dbe-73a9f2ed2204[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Updated MCP server [3mserver_id[0m[2m=[0mmcp_server-2375793e-61fd-41f5-9dbe-73a9f2ed2204
[2m2026-01-25T16:37:40.642513Z[0m [32m INFO[0m [1mupdate_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-e400971a-b451-4e2c-8f3d-a1794fec177f[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Updated MCP server [3mserver_id[0m[2m=[0mmcp_server-e400971a-b451-4e2c-8f3d-a1794fec177f
[2m2026-01-25T16:37:40.650882Z[0m [32m INFO[0m [1mupdate_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-52cfb1fa-026b-4790-ae87-b65c1bbf9b6e[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Updated MCP server [3mserver_id[0m[2m=[0mmcp_server-52cfb1fa-026b-4790-ae87-b65c1bbf9b6e
[2m2026-01-25T16:37:40.654091Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-2375793e-61fd-41f5-9dbe-73a9f2ed2204[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Disconnected MCP client and unregistered tools [3mserver_id[0m[2m=[0mmcp_server-2375793e-61fd-41f5-9dbe-73a9f2ed2204 [3mserver_name[0m[2m=[0mupdated-concurrent-0
[2m2026-01-25T16:37:40.661453Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-2375793e-61fd-41f5-9dbe-73a9f2ed2204[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Deleted MCP server [3mserver_id[0m[2m=[0mmcp_server-2375793e-61fd-41f5-9dbe-73a9f2ed2204
[2m2026-01-25T16:37:40.662341Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-e400971a-b451-4e2c-8f3d-a1794fec177f[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Disconnected MCP client and unregistered tools [3mserver_id[0m[2m=[0mmcp_server-e400971a-b451-4e2c-8f3d-a1794fec177f [3mserver_name[0m[2m=[0mupdated-concurrent-1
[2m2026-01-25T16:37:40.669674Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-e400971a-b451-4e2c-8f3d-a1794fec177f[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Deleted MCP server [3mserver_id[0m[2m=[0mmcp_server-e400971a-b451-4e2c-8f3d-a1794fec177f
[2m2026-01-25T16:37:40.670550Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-52cfb1fa-026b-4790-ae87-b65c1bbf9b6e[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Disconnected MCP client and unregistered tools [3mserver_id[0m[2m=[0mmcp_server-52cfb1fa-026b-4790-ae87-b65c1bbf9b6e [3mserver_name[0m[2m=[0mupdated-concurrent-2
[2m2026-01-25T16:37:40.677466Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-52cfb1fa-026b-4790-ae87-b65c1bbf9b6e[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Deleted MCP server [3mserver_id[0m[2m=[0mmcp_server-52cfb1fa-026b-4790-ae87-b65c1bbf9b6e
PASSED  [ 77%]
tests/sdk/mcp_servers_test.py::test_full_server_lifecycle [2m2026-01-25T16:37:40.687085Z[0m [32m INFO[0m [1mcreate_server[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Created MCP server [3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098 [3mserver_name[0m[2m=[0mlifecycle-test-777c3448
[2m2026-01-25T16:37:40.687127Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mlifecycle-test-777c3448
[2m2026-01-25T16:37:40.687133Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0mnpx [3margs[0m[2m=[0m["-y", "@modelcontextprotocol/server-everything"]
[2m2026-01-25T16:37:40.697445Z[0m [32m INFO[0m [1mupdate_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Updated MCP server [3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098
[2m2026-01-25T16:37:40.698289Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mlifecycle-updated
[2m2026-01-25T16:37:40.698294Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0mnpx [3margs[0m[2m=[0m["-y", "@modelcontextprotocol/server-everything"]
[2m2026-01-25T16:37:40.994636Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m MCP server initialized [3mserver_name[0m[2m=[0mmcp-servers/everything [3mserver_version[0m[2m=[0m2.0.0 [3mprotocol_version[0m[2m=[0m2024-11-05
[2m2026-01-25T16:37:40.994649Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connected to MCP server [3mserver[0m[2m=[0mtest-stdio-0e4bd0d3
[2m2026-01-25T16:37:40.998956Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Discovered tools [3mserver[0m[2m=[0mtest-stdio-0e4bd0d3 [3mtool_count[0m[2m=[0m12 [3mpages[0m[2m=[0m1
[2m2026-01-25T16:37:40.998972Z[0m [32m INFO[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Connected to MCP server and registered tools [3mserver_id[0m[2m=[0mmcp_server-d617a227-2cc4-40c9-b5d6-30e4d93a643a [3mserver_name[0m[2m=[0mtest-stdio-0e4bd0d3 [3mtool_count[0m[2m=[0m12
[2m2026-01-25T16:37:41.004485Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m MCP server initialized [3mserver_name[0m[2m=[0mmcp-servers/everything [3mserver_version[0m[2m=[0m2.0.0 [3mprotocol_version[0m[2m=[0m2024-11-05
[2m2026-01-25T16:37:41.004492Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connected to MCP server [3mserver[0m[2m=[0mlist-test-stdio-94e1399f
[2m2026-01-25T16:37:41.008972Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Discovered tools [3mserver[0m[2m=[0mlist-test-stdio-94e1399f [3mtool_count[0m[2m=[0m12 [3mpages[0m[2m=[0m1
[2m2026-01-25T16:37:41.008990Z[0m [32m INFO[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Connected to MCP server and registered tools [3mserver_id[0m[2m=[0mmcp_server-e2cdcbb9-df6c-473f-99b5-636f4e08b0bb [3mserver_name[0m[2m=[0mlist-test-stdio-94e1399f [3mtool_count[0m[2m=[0m12
[2m2026-01-25T16:37:41.152553Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m MCP server initialized [3mserver_name[0m[2m=[0mmcp-servers/everything [3mserver_version[0m[2m=[0m2.0.0 [3mprotocol_version[0m[2m=[0m2024-11-05
[2m2026-01-25T16:37:41.152601Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connected to MCP server [3mserver[0m[2m=[0mmulti-stdio-766d2b9a
[2m2026-01-25T16:37:41.152915Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m MCP server initialized [3mserver_name[0m[2m=[0mmcp-servers/everything [3mserver_version[0m[2m=[0m2.0.0 [3mprotocol_version[0m[2m=[0m2024-11-05
[2m2026-01-25T16:37:41.152927Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connected to MCP server [3mserver[0m[2m=[0mdelete-test-897ef93c
[2m2026-01-25T16:37:41.155081Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Discovered tools [3mserver[0m[2m=[0mmulti-stdio-766d2b9a [3mtool_count[0m[2m=[0m12 [3mpages[0m[2m=[0m1
[2m2026-01-25T16:37:41.155107Z[0m [32m INFO[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Connected to MCP server and registered tools [3mserver_id[0m[2m=[0mmcp_server-3c0cd1a7-c1e4-42cf-a755-cec42ca78838 [3mserver_name[0m[2m=[0mmulti-stdio-766d2b9a [3mtool_count[0m[2m=[0m12
[2m2026-01-25T16:37:41.156048Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Discovered tools [3mserver[0m[2m=[0mdelete-test-897ef93c [3mtool_count[0m[2m=[0m12 [3mpages[0m[2m=[0m1
[2m2026-01-25T16:37:41.156063Z[0m [32m INFO[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Connected to MCP server and registered tools [3mserver_id[0m[2m=[0mmcp_server-209a2dd0-f4de-46e9-8737-34e912c50f2e [3mserver_name[0m[2m=[0mdelete-test-897ef93c [3mtool_count[0m[2m=[0m12
[2m2026-01-25T16:37:41.329012Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m MCP server initialized [3mserver_name[0m[2m=[0mmcp-servers/everything [3mserver_version[0m[2m=[0m2.0.0 [3mprotocol_version[0m[2m=[0m2024-11-05
[2m2026-01-25T16:37:41.329025Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Connected to MCP server [3mserver[0m[2m=[0mlifecycle-updated
[2m2026-01-25T16:37:41.331952Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m MCP server initialized [3mserver_name[0m[2m=[0mmcp-servers/everything [3mserver_version[0m[2m=[0m2.0.0 [3mprotocol_version[0m[2m=[0m2024-11-05
[2m2026-01-25T16:37:41.331959Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connected to MCP server [3mserver[0m[2m=[0mlifecycle-test-777c3448
[2m2026-01-25T16:37:41.333000Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Discovered tools [3mserver[0m[2m=[0mlifecycle-updated [3mtool_count[0m[2m=[0m12 [3mpages[0m[2m=[0m1
[2m2026-01-25T16:37:41.336010Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Discovered tools [3mserver[0m[2m=[0mlifecycle-test-777c3448 [3mtool_count[0m[2m=[0m12 [3mpages[0m[2m=[0m1
[2m2026-01-25T16:37:41.336031Z[0m [32m INFO[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Connected to MCP server and registered tools [3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098 [3mserver_name[0m[2m=[0mlifecycle-test-777c3448 [3mtool_count[0m[2m=[0m12
[2m2026-01-25T16:37:41.337644Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Disconnected from MCP server [3mserver[0m[2m=[0mlifecycle-updated
[2m2026-01-25T16:37:41.337693Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Discovered MCP server tools [3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098 [3mtool_count[0m[2m=[0m12
[2m2026-01-25T16:37:41.338935Z[0m [32m INFO[0m [1mget_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098 [3mtool_id[0m[2m=[0mmcp_mcp_server-884d54ae-6449-4808-9654-37cd3cfca098_echo[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mlifecycle-updated
[2m2026-01-25T16:37:41.338938Z[0m [32m INFO[0m [1mget_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098 [3mtool_id[0m[2m=[0mmcp_mcp_server-884d54ae-6449-4808-9654-37cd3cfca098_echo[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0mnpx [3margs[0m[2m=[0m["-y", "@modelcontextprotocol/server-everything"]
[2m2026-01-25T16:37:41.940777Z[0m [32m INFO[0m [1mget_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098 [3mtool_id[0m[2m=[0mmcp_mcp_server-884d54ae-6449-4808-9654-37cd3cfca098_echo[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m MCP server initialized [3mserver_name[0m[2m=[0mmcp-servers/everything [3mserver_version[0m[2m=[0m2.0.0 [3mprotocol_version[0m[2m=[0m2024-11-05
[2m2026-01-25T16:37:41.940789Z[0m [32m INFO[0m [1mget_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098 [3mtool_id[0m[2m=[0mmcp_mcp_server-884d54ae-6449-4808-9654-37cd3cfca098_echo[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Connected to MCP server [3mserver[0m[2m=[0mlifecycle-updated
[2m2026-01-25T16:37:41.944465Z[0m [32m INFO[0m [1mget_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098 [3mtool_id[0m[2m=[0mmcp_mcp_server-884d54ae-6449-4808-9654-37cd3cfca098_echo[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Discovered tools [3mserver[0m[2m=[0mlifecycle-updated [3mtool_count[0m[2m=[0m12 [3mpages[0m[2m=[0m1
[2m2026-01-25T16:37:41.948341Z[0m [32m INFO[0m [1mget_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098 [3mtool_id[0m[2m=[0mmcp_mcp_server-884d54ae-6449-4808-9654-37cd3cfca098_echo[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Disconnected from MCP server [3mserver[0m[2m=[0mlifecycle-updated
[2m2026-01-25T16:37:41.948402Z[0m [32m INFO[0m [1mget_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098 [3mtool_id[0m[2m=[0mmcp_mcp_server-884d54ae-6449-4808-9654-37cd3cfca098_echo[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Retrieved MCP server tool [3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098 [3mtool_id[0m[2m=[0mmcp_mcp_server-884d54ae-6449-4808-9654-37cd3cfca098_echo
[2m2026-01-25T16:37:41.949754Z[0m [32m INFO[0m [1mrun_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098 [3mtool_id[0m[2m=[0mmcp_mcp_server-884d54ae-6449-4808-9654-37cd3cfca098_echo[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mlifecycle-updated
[2m2026-01-25T16:37:41.949758Z[0m [32m INFO[0m [1mrun_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098 [3mtool_id[0m[2m=[0mmcp_mcp_server-884d54ae-6449-4808-9654-37cd3cfca098_echo[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0mnpx [3margs[0m[2m=[0m["-y", "@modelcontextprotocol/server-everything"]
[2m2026-01-25T16:37:42.557334Z[0m [32m INFO[0m [1mrun_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098 [3mtool_id[0m[2m=[0mmcp_mcp_server-884d54ae-6449-4808-9654-37cd3cfca098_echo[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m MCP server initialized [3mserver_name[0m[2m=[0mmcp-servers/everything [3mserver_version[0m[2m=[0m2.0.0 [3mprotocol_version[0m[2m=[0m2024-11-05
[2m2026-01-25T16:37:42.557347Z[0m [32m INFO[0m [1mrun_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098 [3mtool_id[0m[2m=[0mmcp_mcp_server-884d54ae-6449-4808-9654-37cd3cfca098_echo[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Connected to MCP server [3mserver[0m[2m=[0mlifecycle-updated
[2m2026-01-25T16:37:42.564749Z[0m [32m INFO[0m [1mrun_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098 [3mtool_id[0m[2m=[0mmcp_mcp_server-884d54ae-6449-4808-9654-37cd3cfca098_echo[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Disconnected from MCP server [3mserver[0m[2m=[0mlifecycle-updated
[2m2026-01-25T16:37:42.564759Z[0m [32m INFO[0m [1mrun_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098 [3mtool_id[0m[2m=[0mmcp_mcp_server-884d54ae-6449-4808-9654-37cd3cfca098_echo[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Executed MCP server tool [3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098 [3mtool_id[0m[2m=[0mmcp_mcp_server-884d54ae-6449-4808-9654-37cd3cfca098_echo
[2m2026-01-25T16:37:42.566702Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Disconnected MCP client and unregistered tools [3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098 [3mserver_name[0m[2m=[0mlifecycle-updated
[2m2026-01-25T16:37:42.574174Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Deleted MCP server [3mserver_id[0m[2m=[0mmcp_server-884d54ae-6449-4808-9654-37cd3cfca098
PASSED         [ 80%]
tests/sdk/mcp_servers_test.py::test_empty_tools_list [2m2026-01-25T16:37:42.583874Z[0m [32m INFO[0m [1mcreate_server[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Created MCP server [3mserver_id[0m[2m=[0mmcp_server-b6d668a7-6077-4697-8cca-80dd19f049d5 [3mserver_name[0m[2m=[0mno-tools-ee7927e6
[2m2026-01-25T16:37:42.583896Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mno-tools-ee7927e6
[2m2026-01-25T16:37:42.583899Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0m/Users/seshendranalla/Development/kelpie/letta-repo/.venv/bin/python3.13 [3margs[0m[2m=[0m["/Users/seshendranalla/Development/kelpie/letta-repo/tests/sdk/mock_mcp_server.py", "--no-tools"]
[2m2026-01-25T16:37:42.584567Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-b6d668a7-6077-4697-8cca-80dd19f049d5[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mno-tools-ee7927e6
[2m2026-01-25T16:37:42.584570Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-b6d668a7-6077-4697-8cca-80dd19f049d5[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0m/Users/seshendranalla/Development/kelpie/letta-repo/.venv/bin/python3.13 [3margs[0m[2m=[0m["/Users/seshendranalla/Development/kelpie/letta-repo/tests/sdk/mock_mcp_server.py", "--no-tools"]
[2m2026-01-25T16:37:42.840977Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m MCP server initialized [3mserver_name[0m[2m=[0mmock-mcp-server [3mserver_version[0m[2m=[0m1.26.0 [3mprotocol_version[0m[2m=[0m2024-11-05
[2m2026-01-25T16:37:42.840989Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connected to MCP server [3mserver[0m[2m=[0mno-tools-ee7927e6
[2m2026-01-25T16:37:42.841026Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-b6d668a7-6077-4697-8cca-80dd19f049d5[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m MCP server initialized [3mserver_name[0m[2m=[0mmock-mcp-server [3mserver_version[0m[2m=[0m1.26.0 [3mprotocol_version[0m[2m=[0m2024-11-05
[2m2026-01-25T16:37:42.841032Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-b6d668a7-6077-4697-8cca-80dd19f049d5[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Connected to MCP server [3mserver[0m[2m=[0mno-tools-ee7927e6
[2m2026-01-25T16:37:42.841890Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-b6d668a7-6077-4697-8cca-80dd19f049d5[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Discovered tools [3mserver[0m[2m=[0mno-tools-ee7927e6 [3mtool_count[0m[2m=[0m0 [3mpages[0m[2m=[0m1
[2m2026-01-25T16:37:42.841962Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Discovered tools [3mserver[0m[2m=[0mno-tools-ee7927e6 [3mtool_count[0m[2m=[0m0 [3mpages[0m[2m=[0m1
[2m2026-01-25T16:37:42.841966Z[0m [32m INFO[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Connected to MCP server and registered tools [3mserver_id[0m[2m=[0mmcp_server-b6d668a7-6077-4697-8cca-80dd19f049d5 [3mserver_name[0m[2m=[0mno-tools-ee7927e6 [3mtool_count[0m[2m=[0m0
[2m2026-01-25T16:37:42.843327Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-b6d668a7-6077-4697-8cca-80dd19f049d5[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Disconnected from MCP server [3mserver[0m[2m=[0mno-tools-ee7927e6
[2m2026-01-25T16:37:42.843332Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-b6d668a7-6077-4697-8cca-80dd19f049d5[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Discovered MCP server tools [3mserver_id[0m[2m=[0mmcp_server-b6d668a7-6077-4697-8cca-80dd19f049d5 [3mtool_count[0m[2m=[0m0
[2m2026-01-25T16:37:42.845324Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-b6d668a7-6077-4697-8cca-80dd19f049d5[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Disconnected from MCP server [3mserver[0m[2m=[0mno-tools-ee7927e6
[2m2026-01-25T16:37:42.845331Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-b6d668a7-6077-4697-8cca-80dd19f049d5[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Disconnected MCP client and unregistered tools [3mserver_id[0m[2m=[0mmcp_server-b6d668a7-6077-4697-8cca-80dd19f049d5 [3mserver_name[0m[2m=[0mno-tools-ee7927e6
[2m2026-01-25T16:37:42.854971Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-b6d668a7-6077-4697-8cca-80dd19f049d5[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Deleted MCP server [3mserver_id[0m[2m=[0mmcp_server-b6d668a7-6077-4697-8cca-80dd19f049d5
PASSED              [ 82%]
tests/sdk/mcp_servers_test.py::test_mcp_echo_tool_with_agent [2m2026-01-25T16:37:42.864171Z[0m [32m INFO[0m [1mcreate_server[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Created MCP server [3mserver_id[0m[2m=[0mmcp_server-4b996a35-edc1-4df9-8e30-bfc43c1282e6 [3mserver_name[0m[2m=[0mtest-mcp-agent-d2cb2bfa
[2m2026-01-25T16:37:42.864196Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mtest-mcp-agent-d2cb2bfa
[2m2026-01-25T16:37:42.864199Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0m/Users/seshendranalla/Development/kelpie/letta-repo/.venv/bin/python3.13 [3margs[0m[2m=[0m["/Users/seshendranalla/Development/kelpie/letta-repo/tests/sdk/mock_mcp_server.py"]
[2m2026-01-25T16:37:42.864960Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-4b996a35-edc1-4df9-8e30-bfc43c1282e6[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mtest-mcp-agent-d2cb2bfa
[2m2026-01-25T16:37:42.864963Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-4b996a35-edc1-4df9-8e30-bfc43c1282e6[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0m/Users/seshendranalla/Development/kelpie/letta-repo/.venv/bin/python3.13 [3margs[0m[2m=[0m["/Users/seshendranalla/Development/kelpie/letta-repo/tests/sdk/mock_mcp_server.py"]
[2m2026-01-25T16:37:43.118767Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-4b996a35-edc1-4df9-8e30-bfc43c1282e6[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m MCP server initialized [3mserver_name[0m[2m=[0mmock-mcp-server [3mserver_version[0m[2m=[0m1.26.0 [3mprotocol_version[0m[2m=[0m2024-11-05
[2m2026-01-25T16:37:43.118780Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-4b996a35-edc1-4df9-8e30-bfc43c1282e6[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Connected to MCP server [3mserver[0m[2m=[0mtest-mcp-agent-d2cb2bfa
[2m2026-01-25T16:37:43.118808Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m MCP server initialized [3mserver_name[0m[2m=[0mmock-mcp-server [3mserver_version[0m[2m=[0m1.26.0 [3mprotocol_version[0m[2m=[0m2024-11-05
[2m2026-01-25T16:37:43.118813Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connected to MCP server [3mserver[0m[2m=[0mtest-mcp-agent-d2cb2bfa
[2m2026-01-25T16:37:43.119832Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-4b996a35-edc1-4df9-8e30-bfc43c1282e6[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Discovered tools [3mserver[0m[2m=[0mtest-mcp-agent-d2cb2bfa [3mtool_count[0m[2m=[0m9 [3mpages[0m[2m=[0m1
[2m2026-01-25T16:37:43.119913Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Discovered tools [3mserver[0m[2m=[0mtest-mcp-agent-d2cb2bfa [3mtool_count[0m[2m=[0m9 [3mpages[0m[2m=[0m1
[2m2026-01-25T16:37:43.119923Z[0m [32m INFO[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Connected to MCP server and registered tools [3mserver_id[0m[2m=[0mmcp_server-4b996a35-edc1-4df9-8e30-bfc43c1282e6 [3mserver_name[0m[2m=[0mtest-mcp-agent-d2cb2bfa [3mtool_count[0m[2m=[0m9
[2m2026-01-25T16:37:43.121256Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-4b996a35-edc1-4df9-8e30-bfc43c1282e6[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Disconnected from MCP server [3mserver[0m[2m=[0mtest-mcp-agent-d2cb2bfa
[2m2026-01-25T16:37:43.121325Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-4b996a35-edc1-4df9-8e30-bfc43c1282e6[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Discovered MCP server tools [3mserver_id[0m[2m=[0mmcp_server-4b996a35-edc1-4df9-8e30-bfc43c1282e6 [3mtool_count[0m[2m=[0m9
[2m2026-01-25T16:37:43.152408Z[0m [32m INFO[0m [1mrun[0m[2m:[0m[1mactivate[0m[1m{[0m[3mid[0m[2m=[0mActorId { namespace: "agents", id: "78260e5a-ed43-44cf-9b54-1528d63514fb" } [3mactor_id[0m[2m=[0magents:78260e5a-ed43-44cf-9b54-1528d63514fb[1m}[0m[2m:[0m[1mactivate_with_time[0m[1m{[0m[3mid[0m[2m=[0mActorId { namespace: "agents", id: "78260e5a-ed43-44cf-9b54-1528d63514fb" } [3mactor_id[0m[2m=[0magents:78260e5a-ed43-44cf-9b54-1528d63514fb[1m}[0m[2m:[0m [2mkelpie_runtime::activation[0m[2m:[0m Actor activated [3mactor_id[0m[2m=[0magents:78260e5a-ed43-44cf-9b54-1528d63514fb
[2m2026-01-25T16:37:43.160308Z[0m [32m INFO[0m [1mcreate_agent[0m[1m{[0m[3magent_name[0m[2m=[0mtest_mcp_agent_494b0f7a[1m}[0m[2m:[0m [2mkelpie_server::state[0m[2m:[0m agent metadata persisted to storage [3magent_id[0m[2m=[0m78260e5a-ed43-44cf-9b54-1528d63514fb
[2m2026-01-25T16:37:43.167539Z[0m [33m WARN[0m [1mcreate_agent[0m[1m{[0m[3magent_name[0m[2m=[0mtest_mcp_agent_494b0f7a[1m}[0m[2m:[0m [2mkelpie_server::api::agents[0m[2m:[0m Referenced MCP tool not found in registry (server may need to be created first) [3magent_id[0m[2m=[0m78260e5a-ed43-44cf-9b54-1528d63514fb [3mtool_id[0m[2m=[0mmcp_mcp_server-4b996a35-edc1-4df9-8e30-bfc43c1282e6_echo
[2m2026-01-25T16:37:43.167545Z[0m [33m WARN[0m [1mcreate_agent[0m[1m{[0m[3magent_name[0m[2m=[0mtest_mcp_agent_494b0f7a[1m}[0m[2m:[0m [2mkelpie_server::api::agents[0m[2m:[0m Referenced MCP tool not found in registry (server may need to be created first) [3magent_id[0m[2m=[0m78260e5a-ed43-44cf-9b54-1528d63514fb [3mtool_id[0m[2m=[0mmcp_mcp_server-4b996a35-edc1-4df9-8e30-bfc43c1282e6_add
[2m2026-01-25T16:37:43.167547Z[0m [32m INFO[0m [1mcreate_agent[0m[1m{[0m[3magent_name[0m[2m=[0mtest_mcp_agent_494b0f7a[1m}[0m[2m:[0m [2mkelpie_server::api::agents[0m[2m:[0m created agent [3magent_id[0m[2m=[0m78260e5a-ed43-44cf-9b54-1528d63514fb [3mname[0m[2m=[0mtest_mcp_agent_494b0f7a [3mblock_count[0m[2m=[0m2
[2m2026-01-25T16:37:43.169284Z[0m [32m INFO[0m [1msend_message[0m[1m{[0m[3magent_id[0m[2m=[0m78260e5a-ed43-44cf-9b54-1528d63514fb[1m}[0m[2m:[0m [2mkelpie_server::api::messages[0m[2m:[0m Processing message request [3mstream_steps[0m[2m=[0mfalse [3mstream_tokens[0m[2m=[0mfalse
[2m2026-01-25T16:37:49.505021Z[0m [32m INFO[0m [1msend_message[0m[1m{[0m[3magent_id[0m[2m=[0m78260e5a-ed43-44cf-9b54-1528d63514fb[1m}[0m[2m:[0m[1msend_message_json[0m[1m{[0m[3magent_id[0m[2m=[0m78260e5a-ed43-44cf-9b54-1528d63514fb[1m}[0m[2m:[0m [2mkelpie_server::api::messages[0m[2m:[0m Processed message via AgentService [3magent_id[0m[2m=[0m78260e5a-ed43-44cf-9b54-1528d63514fb [3mmessage_count[0m[2m=[0m5
FAILED      [ 84%][2m2026-01-25T16:37:49.546609Z[0m [32m INFO[0m [1mdelete_agent[0m[1m{[0m[3magent_id[0m[2m=[0m78260e5a-ed43-44cf-9b54-1528d63514fb[1m}[0m[2m:[0m [2mkelpie_server::api::agents[0m[2m:[0m deleted agent [3magent_id[0m[2m=[0m78260e5a-ed43-44cf-9b54-1528d63514fb
[2m2026-01-25T16:37:49.546664Z[0m [32m INFO[0m [1mrun[0m[2m:[0m[1mdeactivate[0m[1m{[0m[3mactor_id[0m[2m=[0magents:78260e5a-ed43-44cf-9b54-1528d63514fb[1m}[0m[2m:[0m [2mkelpie_runtime::activation[0m[2m:[0m Actor deactivated [3mactor_id[0m[2m=[0magents:78260e5a-ed43-44cf-9b54-1528d63514fb [3minvocations[0m[2m=[0m3 [3merrors[0m[2m=[0m0
[2m2026-01-25T16:37:49.548937Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-4b996a35-edc1-4df9-8e30-bfc43c1282e6[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Disconnected from MCP server [3mserver[0m[2m=[0mtest-mcp-agent-d2cb2bfa
[2m2026-01-25T16:37:49.548973Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-4b996a35-edc1-4df9-8e30-bfc43c1282e6[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Disconnected MCP client and unregistered tools [3mserver_id[0m[2m=[0mmcp_server-4b996a35-edc1-4df9-8e30-bfc43c1282e6 [3mserver_name[0m[2m=[0mtest-mcp-agent-d2cb2bfa
[2m2026-01-25T16:37:49.558046Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-4b996a35-edc1-4df9-8e30-bfc43c1282e6[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Deleted MCP server [3mserver_id[0m[2m=[0mmcp_server-4b996a35-edc1-4df9-8e30-bfc43c1282e6

tests/sdk/mcp_servers_test.py::test_mcp_add_tool_with_agent [2m2026-01-25T16:37:49.571529Z[0m [32m INFO[0m [1mcreate_server[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Created MCP server [3mserver_id[0m[2m=[0mmcp_server-bb90f8e4-b6a4-47e2-8858-e0e6c66b95fe [3mserver_name[0m[2m=[0mtest-mcp-agent-ca376722
[2m2026-01-25T16:37:49.571557Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mtest-mcp-agent-ca376722
[2m2026-01-25T16:37:49.571560Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0m/Users/seshendranalla/Development/kelpie/letta-repo/.venv/bin/python3.13 [3margs[0m[2m=[0m["/Users/seshendranalla/Development/kelpie/letta-repo/tests/sdk/mock_mcp_server.py"]
[2m2026-01-25T16:37:49.572280Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-bb90f8e4-b6a4-47e2-8858-e0e6c66b95fe[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mtest-mcp-agent-ca376722
[2m2026-01-25T16:37:49.572286Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-bb90f8e4-b6a4-47e2-8858-e0e6c66b95fe[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0m/Users/seshendranalla/Development/kelpie/letta-repo/.venv/bin/python3.13 [3margs[0m[2m=[0m["/Users/seshendranalla/Development/kelpie/letta-repo/tests/sdk/mock_mcp_server.py"]
[2m2026-01-25T16:37:49.837160Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m MCP server initialized [3mserver_name[0m[2m=[0mmock-mcp-server [3mserver_version[0m[2m=[0m1.26.0 [3mprotocol_version[0m[2m=[0m2024-11-05
[2m2026-01-25T16:37:49.837170Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connected to MCP server [3mserver[0m[2m=[0mtest-mcp-agent-ca376722
[2m2026-01-25T16:37:49.838393Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Discovered tools [3mserver[0m[2m=[0mtest-mcp-agent-ca376722 [3mtool_count[0m[2m=[0m9 [3mpages[0m[2m=[0m1
[2m2026-01-25T16:37:49.838403Z[0m [32m INFO[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Connected to MCP server and registered tools [3mserver_id[0m[2m=[0mmcp_server-bb90f8e4-b6a4-47e2-8858-e0e6c66b95fe [3mserver_name[0m[2m=[0mtest-mcp-agent-ca376722 [3mtool_count[0m[2m=[0m9
[2m2026-01-25T16:37:49.838649Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-bb90f8e4-b6a4-47e2-8858-e0e6c66b95fe[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m MCP server initialized [3mserver_name[0m[2m=[0mmock-mcp-server [3mserver_version[0m[2m=[0m1.26.0 [3mprotocol_version[0m[2m=[0m2024-11-05
[2m2026-01-25T16:37:49.838654Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-bb90f8e4-b6a4-47e2-8858-e0e6c66b95fe[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Connected to MCP server [3mserver[0m[2m=[0mtest-mcp-agent-ca376722
[2m2026-01-25T16:37:49.839659Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-bb90f8e4-b6a4-47e2-8858-e0e6c66b95fe[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Discovered tools [3mserver[0m[2m=[0mtest-mcp-agent-ca376722 [3mtool_count[0m[2m=[0m9 [3mpages[0m[2m=[0m1
[2m2026-01-25T16:37:49.841165Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-bb90f8e4-b6a4-47e2-8858-e0e6c66b95fe[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Disconnected from MCP server [3mserver[0m[2m=[0mtest-mcp-agent-ca376722
[2m2026-01-25T16:37:49.841234Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-bb90f8e4-b6a4-47e2-8858-e0e6c66b95fe[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Discovered MCP server tools [3mserver_id[0m[2m=[0mmcp_server-bb90f8e4-b6a4-47e2-8858-e0e6c66b95fe [3mtool_count[0m[2m=[0m9
[2m2026-01-25T16:37:49.842548Z[0m [32m INFO[0m [1mrun[0m[2m:[0m[1mactivate[0m[1m{[0m[3mid[0m[2m=[0mActorId { namespace: "agents", id: "0eecc832-e03d-4910-8d31-aea9fd9a3aec" } [3mactor_id[0m[2m=[0magents:0eecc832-e03d-4910-8d31-aea9fd9a3aec[1m}[0m[2m:[0m[1mactivate_with_time[0m[1m{[0m[3mid[0m[2m=[0mActorId { namespace: "agents", id: "0eecc832-e03d-4910-8d31-aea9fd9a3aec" } [3mactor_id[0m[2m=[0magents:0eecc832-e03d-4910-8d31-aea9fd9a3aec[1m}[0m[2m:[0m [2mkelpie_runtime::activation[0m[2m:[0m Actor activated [3mactor_id[0m[2m=[0magents:0eecc832-e03d-4910-8d31-aea9fd9a3aec
[2m2026-01-25T16:37:49.850044Z[0m [32m INFO[0m [1mcreate_agent[0m[1m{[0m[3magent_name[0m[2m=[0mtest_mcp_agent_4bba2070[1m}[0m[2m:[0m [2mkelpie_server::state[0m[2m:[0m agent metadata persisted to storage [3magent_id[0m[2m=[0m0eecc832-e03d-4910-8d31-aea9fd9a3aec
[2m2026-01-25T16:37:49.857316Z[0m [33m WARN[0m [1mcreate_agent[0m[1m{[0m[3magent_name[0m[2m=[0mtest_mcp_agent_4bba2070[1m}[0m[2m:[0m [2mkelpie_server::api::agents[0m[2m:[0m Referenced MCP tool not found in registry (server may need to be created first) [3magent_id[0m[2m=[0m0eecc832-e03d-4910-8d31-aea9fd9a3aec [3mtool_id[0m[2m=[0mmcp_mcp_server-bb90f8e4-b6a4-47e2-8858-e0e6c66b95fe_echo
[2m2026-01-25T16:37:49.857320Z[0m [33m WARN[0m [1mcreate_agent[0m[1m{[0m[3magent_name[0m[2m=[0mtest_mcp_agent_4bba2070[1m}[0m[2m:[0m [2mkelpie_server::api::agents[0m[2m:[0m Referenced MCP tool not found in registry (server may need to be created first) [3magent_id[0m[2m=[0m0eecc832-e03d-4910-8d31-aea9fd9a3aec [3mtool_id[0m[2m=[0mmcp_mcp_server-bb90f8e4-b6a4-47e2-8858-e0e6c66b95fe_add
[2m2026-01-25T16:37:49.857322Z[0m [32m INFO[0m [1mcreate_agent[0m[1m{[0m[3magent_name[0m[2m=[0mtest_mcp_agent_4bba2070[1m}[0m[2m:[0m [2mkelpie_server::api::agents[0m[2m:[0m created agent [3magent_id[0m[2m=[0m0eecc832-e03d-4910-8d31-aea9fd9a3aec [3mname[0m[2m=[0mtest_mcp_agent_4bba2070 [3mblock_count[0m[2m=[0m2
[2m2026-01-25T16:37:49.858474Z[0m [32m INFO[0m [1msend_message[0m[1m{[0m[3magent_id[0m[2m=[0m0eecc832-e03d-4910-8d31-aea9fd9a3aec[1m}[0m[2m:[0m [2mkelpie_server::api::messages[0m[2m:[0m Processing message request [3mstream_steps[0m[2m=[0mfalse [3mstream_tokens[0m[2m=[0mfalse
[2m2026-01-25T16:37:58.979456Z[0m [32m INFO[0m [1msend_message[0m[1m{[0m[3magent_id[0m[2m=[0m0eecc832-e03d-4910-8d31-aea9fd9a3aec[1m}[0m[2m:[0m[1msend_message_json[0m[1m{[0m[3magent_id[0m[2m=[0m0eecc832-e03d-4910-8d31-aea9fd9a3aec[1m}[0m[2m:[0m [2mkelpie_server::api::messages[0m[2m:[0m Processed message via AgentService [3magent_id[0m[2m=[0m0eecc832-e03d-4910-8d31-aea9fd9a3aec [3mmessage_count[0m[2m=[0m5
FAILED       [ 86%][2m2026-01-25T16:37:58.993595Z[0m [32m INFO[0m [1mdelete_agent[0m[1m{[0m[3magent_id[0m[2m=[0m0eecc832-e03d-4910-8d31-aea9fd9a3aec[1m}[0m[2m:[0m [2mkelpie_server::api::agents[0m[2m:[0m deleted agent [3magent_id[0m[2m=[0m0eecc832-e03d-4910-8d31-aea9fd9a3aec
[2m2026-01-25T16:37:58.993643Z[0m [32m INFO[0m [1mrun[0m[2m:[0m[1mdeactivate[0m[1m{[0m[3mactor_id[0m[2m=[0magents:0eecc832-e03d-4910-8d31-aea9fd9a3aec[1m}[0m[2m:[0m [2mkelpie_runtime::activation[0m[2m:[0m Actor deactivated [3mactor_id[0m[2m=[0magents:0eecc832-e03d-4910-8d31-aea9fd9a3aec [3minvocations[0m[2m=[0m3 [3merrors[0m[2m=[0m0
[2m2026-01-25T16:37:58.995939Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-bb90f8e4-b6a4-47e2-8858-e0e6c66b95fe[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Disconnected from MCP server [3mserver[0m[2m=[0mtest-mcp-agent-ca376722
[2m2026-01-25T16:37:58.995974Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-bb90f8e4-b6a4-47e2-8858-e0e6c66b95fe[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Disconnected MCP client and unregistered tools [3mserver_id[0m[2m=[0mmcp_server-bb90f8e4-b6a4-47e2-8858-e0e6c66b95fe [3mserver_name[0m[2m=[0mtest-mcp-agent-ca376722
[2m2026-01-25T16:37:59.007246Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-bb90f8e4-b6a4-47e2-8858-e0e6c66b95fe[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Deleted MCP server [3mserver_id[0m[2m=[0mmcp_server-bb90f8e4-b6a4-47e2-8858-e0e6c66b95fe

tests/sdk/mcp_servers_test.py::test_mcp_multiple_tools_in_sequence_with_agent [2m2026-01-25T16:37:59.020140Z[0m [32m INFO[0m [1mcreate_server[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Created MCP server [3mserver_id[0m[2m=[0mmcp_server-486a02bc-b186-4762-9ade-33fb043194f0 [3mserver_name[0m[2m=[0mtest-multi-tools-307a2a30
[2m2026-01-25T16:37:59.020173Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mtest-multi-tools-307a2a30
[2m2026-01-25T16:37:59.020177Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0m/Users/seshendranalla/Development/kelpie/letta-repo/.venv/bin/python3.13 [3margs[0m[2m=[0m["/Users/seshendranalla/Development/kelpie/letta-repo/tests/sdk/mock_mcp_server.py"]
[2m2026-01-25T16:37:59.021280Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-486a02bc-b186-4762-9ade-33fb043194f0[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mtest-multi-tools-307a2a30
[2m2026-01-25T16:37:59.021285Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-486a02bc-b186-4762-9ade-33fb043194f0[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0m/Users/seshendranalla/Development/kelpie/letta-repo/.venv/bin/python3.13 [3margs[0m[2m=[0m["/Users/seshendranalla/Development/kelpie/letta-repo/tests/sdk/mock_mcp_server.py"]
[2m2026-01-25T16:37:59.283960Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m MCP server initialized [3mserver_name[0m[2m=[0mmock-mcp-server [3mserver_version[0m[2m=[0m1.26.0 [3mprotocol_version[0m[2m=[0m2024-11-05
[2m2026-01-25T16:37:59.283971Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connected to MCP server [3mserver[0m[2m=[0mtest-multi-tools-307a2a30
[2m2026-01-25T16:37:59.284064Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-486a02bc-b186-4762-9ade-33fb043194f0[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m MCP server initialized [3mserver_name[0m[2m=[0mmock-mcp-server [3mserver_version[0m[2m=[0m1.26.0 [3mprotocol_version[0m[2m=[0m2024-11-05
[2m2026-01-25T16:37:59.284072Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-486a02bc-b186-4762-9ade-33fb043194f0[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Connected to MCP server [3mserver[0m[2m=[0mtest-multi-tools-307a2a30
[2m2026-01-25T16:37:59.285062Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Discovered tools [3mserver[0m[2m=[0mtest-multi-tools-307a2a30 [3mtool_count[0m[2m=[0m9 [3mpages[0m[2m=[0m1
[2m2026-01-25T16:37:59.285072Z[0m [32m INFO[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Connected to MCP server and registered tools [3mserver_id[0m[2m=[0mmcp_server-486a02bc-b186-4762-9ade-33fb043194f0 [3mserver_name[0m[2m=[0mtest-multi-tools-307a2a30 [3mtool_count[0m[2m=[0m9
[2m2026-01-25T16:37:59.285257Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-486a02bc-b186-4762-9ade-33fb043194f0[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Discovered tools [3mserver[0m[2m=[0mtest-multi-tools-307a2a30 [3mtool_count[0m[2m=[0m9 [3mpages[0m[2m=[0m1
[2m2026-01-25T16:37:59.286663Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-486a02bc-b186-4762-9ade-33fb043194f0[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Disconnected from MCP server [3mserver[0m[2m=[0mtest-multi-tools-307a2a30
[2m2026-01-25T16:37:59.286734Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-486a02bc-b186-4762-9ade-33fb043194f0[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Discovered MCP server tools [3mserver_id[0m[2m=[0mmcp_server-486a02bc-b186-4762-9ade-33fb043194f0 [3mtool_count[0m[2m=[0m9
[2m2026-01-25T16:37:59.288011Z[0m [32m INFO[0m [1mrun[0m[2m:[0m[1mactivate[0m[1m{[0m[3mid[0m[2m=[0mActorId { namespace: "agents", id: "18f5aa72-a062-4aef-8566-8ad496add394" } [3mactor_id[0m[2m=[0magents:18f5aa72-a062-4aef-8566-8ad496add394[1m}[0m[2m:[0m[1mactivate_with_time[0m[1m{[0m[3mid[0m[2m=[0mActorId { namespace: "agents", id: "18f5aa72-a062-4aef-8566-8ad496add394" } [3mactor_id[0m[2m=[0magents:18f5aa72-a062-4aef-8566-8ad496add394[1m}[0m[2m:[0m [2mkelpie_runtime::activation[0m[2m:[0m Actor activated [3mactor_id[0m[2m=[0magents:18f5aa72-a062-4aef-8566-8ad496add394
[2m2026-01-25T16:37:59.297210Z[0m [32m INFO[0m [1mcreate_agent[0m[1m{[0m[3magent_name[0m[2m=[0mtest_multi_tools_189c393b[1m}[0m[2m:[0m [2mkelpie_server::state[0m[2m:[0m agent metadata persisted to storage [3magent_id[0m[2m=[0m18f5aa72-a062-4aef-8566-8ad496add394
[2m2026-01-25T16:37:59.304658Z[0m [33m WARN[0m [1mcreate_agent[0m[1m{[0m[3magent_name[0m[2m=[0mtest_multi_tools_189c393b[1m}[0m[2m:[0m [2mkelpie_server::api::agents[0m[2m:[0m Referenced MCP tool not found in registry (server may need to be created first) [3magent_id[0m[2m=[0m18f5aa72-a062-4aef-8566-8ad496add394 [3mtool_id[0m[2m=[0mmcp_mcp_server-486a02bc-b186-4762-9ade-33fb043194f0_add
[2m2026-01-25T16:37:59.304664Z[0m [33m WARN[0m [1mcreate_agent[0m[1m{[0m[3magent_name[0m[2m=[0mtest_multi_tools_189c393b[1m}[0m[2m:[0m [2mkelpie_server::api::agents[0m[2m:[0m Referenced MCP tool not found in registry (server may need to be created first) [3magent_id[0m[2m=[0m18f5aa72-a062-4aef-8566-8ad496add394 [3mtool_id[0m[2m=[0mmcp_mcp_server-486a02bc-b186-4762-9ade-33fb043194f0_multiply
[2m2026-01-25T16:37:59.304666Z[0m [33m WARN[0m [1mcreate_agent[0m[1m{[0m[3magent_name[0m[2m=[0mtest_multi_tools_189c393b[1m}[0m[2m:[0m [2mkelpie_server::api::agents[0m[2m:[0m Referenced MCP tool not found in registry (server may need to be created first) [3magent_id[0m[2m=[0m18f5aa72-a062-4aef-8566-8ad496add394 [3mtool_id[0m[2m=[0mmcp_mcp_server-486a02bc-b186-4762-9ade-33fb043194f0_echo
[2m2026-01-25T16:37:59.304668Z[0m [32m INFO[0m [1mcreate_agent[0m[1m{[0m[3magent_name[0m[2m=[0mtest_multi_tools_189c393b[1m}[0m[2m:[0m [2mkelpie_server::api::agents[0m[2m:[0m created agent [3magent_id[0m[2m=[0m18f5aa72-a062-4aef-8566-8ad496add394 [3mname[0m[2m=[0mtest_multi_tools_189c393b [3mblock_count[0m[2m=[0m2
[2m2026-01-25T16:37:59.305571Z[0m [32m INFO[0m [1msend_message[0m[1m{[0m[3magent_id[0m[2m=[0m18f5aa72-a062-4aef-8566-8ad496add394[1m}[0m[2m:[0m [2mkelpie_server::api::messages[0m[2m:[0m Processing message request [3mstream_steps[0m[2m=[0mfalse [3mstream_tokens[0m[2m=[0mfalse
[2m2026-01-25T16:38:07.957625Z[0m [32m INFO[0m [1msend_message[0m[1m{[0m[3magent_id[0m[2m=[0m18f5aa72-a062-4aef-8566-8ad496add394[1m}[0m[2m:[0m[1msend_message_json[0m[1m{[0m[3magent_id[0m[2m=[0m18f5aa72-a062-4aef-8566-8ad496add394[1m}[0m[2m:[0m [2mkelpie_server::api::messages[0m[2m:[0m Processed message via AgentService [3magent_id[0m[2m=[0m18f5aa72-a062-4aef-8566-8ad496add394 [3mmessage_count[0m[2m=[0m5
[2m2026-01-25T16:38:07.963523Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-486a02bc-b186-4762-9ade-33fb043194f0[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Disconnected from MCP server [3mserver[0m[2m=[0mtest-multi-tools-307a2a30
[2m2026-01-25T16:38:07.963588Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-486a02bc-b186-4762-9ade-33fb043194f0[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Disconnected MCP client and unregistered tools [3mserver_id[0m[2m=[0mmcp_server-486a02bc-b186-4762-9ade-33fb043194f0 [3mserver_name[0m[2m=[0mtest-multi-tools-307a2a30
[2m2026-01-25T16:38:07.972030Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-486a02bc-b186-4762-9ade-33fb043194f0[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Deleted MCP server [3mserver_id[0m[2m=[0mmcp_server-486a02bc-b186-4762-9ade-33fb043194f0
FAILED [ 88%]
tests/sdk/mcp_servers_test.py::test_mcp_complex_schema_tool_with_agent [2m2026-01-25T16:38:07.997025Z[0m [32m INFO[0m [1mcreate_server[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Created MCP server [3mserver_id[0m[2m=[0mmcp_server-d15db7c5-3bc5-4814-8ed2-e3d6216ffb10 [3mserver_name[0m[2m=[0mtest-complex-schema-8d98a68f
[2m2026-01-25T16:38:07.997075Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mtest-complex-schema-8d98a68f
[2m2026-01-25T16:38:07.997079Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0m/Users/seshendranalla/Development/kelpie/letta-repo/.venv/bin/python3.13 [3margs[0m[2m=[0m["/Users/seshendranalla/Development/kelpie/letta-repo/tests/sdk/mock_mcp_server.py"]
[2m2026-01-25T16:38:07.998004Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-d15db7c5-3bc5-4814-8ed2-e3d6216ffb10[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mtest-complex-schema-8d98a68f
[2m2026-01-25T16:38:07.998011Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-d15db7c5-3bc5-4814-8ed2-e3d6216ffb10[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0m/Users/seshendranalla/Development/kelpie/letta-repo/.venv/bin/python3.13 [3margs[0m[2m=[0m["/Users/seshendranalla/Development/kelpie/letta-repo/tests/sdk/mock_mcp_server.py"]
[2m2026-01-25T16:38:08.261955Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-d15db7c5-3bc5-4814-8ed2-e3d6216ffb10[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m MCP server initialized [3mserver_name[0m[2m=[0mmock-mcp-server [3mserver_version[0m[2m=[0m1.26.0 [3mprotocol_version[0m[2m=[0m2024-11-05
[2m2026-01-25T16:38:08.261967Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-d15db7c5-3bc5-4814-8ed2-e3d6216ffb10[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Connected to MCP server [3mserver[0m[2m=[0mtest-complex-schema-8d98a68f
[2m2026-01-25T16:38:08.263111Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-d15db7c5-3bc5-4814-8ed2-e3d6216ffb10[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Discovered tools [3mserver[0m[2m=[0mtest-complex-schema-8d98a68f [3mtool_count[0m[2m=[0m9 [3mpages[0m[2m=[0m1
[2m2026-01-25T16:38:08.263609Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m MCP server initialized [3mserver_name[0m[2m=[0mmock-mcp-server [3mserver_version[0m[2m=[0m1.26.0 [3mprotocol_version[0m[2m=[0m2024-11-05
[2m2026-01-25T16:38:08.263613Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connected to MCP server [3mserver[0m[2m=[0mtest-complex-schema-8d98a68f
[2m2026-01-25T16:38:08.264587Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-d15db7c5-3bc5-4814-8ed2-e3d6216ffb10[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Disconnected from MCP server [3mserver[0m[2m=[0mtest-complex-schema-8d98a68f
[2m2026-01-25T16:38:08.264668Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-d15db7c5-3bc5-4814-8ed2-e3d6216ffb10[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Discovered MCP server tools [3mserver_id[0m[2m=[0mmcp_server-d15db7c5-3bc5-4814-8ed2-e3d6216ffb10 [3mtool_count[0m[2m=[0m9
[2m2026-01-25T16:38:08.264672Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Discovered tools [3mserver[0m[2m=[0mtest-complex-schema-8d98a68f [3mtool_count[0m[2m=[0m9 [3mpages[0m[2m=[0m1
[2m2026-01-25T16:38:08.264681Z[0m [32m INFO[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Connected to MCP server and registered tools [3mserver_id[0m[2m=[0mmcp_server-d15db7c5-3bc5-4814-8ed2-e3d6216ffb10 [3mserver_name[0m[2m=[0mtest-complex-schema-8d98a68f [3mtool_count[0m[2m=[0m9
[2m2026-01-25T16:38:08.265932Z[0m [32m INFO[0m [1mrun[0m[2m:[0m[1mactivate[0m[1m{[0m[3mid[0m[2m=[0mActorId { namespace: "agents", id: "5f5b1677-27ab-4e67-bb65-46ac85ae9ec9" } [3mactor_id[0m[2m=[0magents:5f5b1677-27ab-4e67-bb65-46ac85ae9ec9[1m}[0m[2m:[0m[1mactivate_with_time[0m[1m{[0m[3mid[0m[2m=[0mActorId { namespace: "agents", id: "5f5b1677-27ab-4e67-bb65-46ac85ae9ec9" } [3mactor_id[0m[2m=[0magents:5f5b1677-27ab-4e67-bb65-46ac85ae9ec9[1m}[0m[2m:[0m [2mkelpie_runtime::activation[0m[2m:[0m Actor activated [3mactor_id[0m[2m=[0magents:5f5b1677-27ab-4e67-bb65-46ac85ae9ec9
[2m2026-01-25T16:38:08.273816Z[0m [32m INFO[0m [1mcreate_agent[0m[1m{[0m[3magent_name[0m[2m=[0mtest_complex_schema_eb76b64f[1m}[0m[2m:[0m [2mkelpie_server::state[0m[2m:[0m agent metadata persisted to storage [3magent_id[0m[2m=[0m5f5b1677-27ab-4e67-bb65-46ac85ae9ec9
[2m2026-01-25T16:38:08.280582Z[0m [33m WARN[0m [1mcreate_agent[0m[1m{[0m[3magent_name[0m[2m=[0mtest_complex_schema_eb76b64f[1m}[0m[2m:[0m [2mkelpie_server::api::agents[0m[2m:[0m Referenced MCP tool not found in registry (server may need to be created first) [3magent_id[0m[2m=[0m5f5b1677-27ab-4e67-bb65-46ac85ae9ec9 [3mtool_id[0m[2m=[0mmcp_mcp_server-d15db7c5-3bc5-4814-8ed2-e3d6216ffb10_get_parameter_type_description
[2m2026-01-25T16:38:08.280587Z[0m [33m WARN[0m [1mcreate_agent[0m[1m{[0m[3magent_name[0m[2m=[0mtest_complex_schema_eb76b64f[1m}[0m[2m:[0m [2mkelpie_server::api::agents[0m[2m:[0m Referenced MCP tool not found in registry (server may need to be created first) [3magent_id[0m[2m=[0m5f5b1677-27ab-4e67-bb65-46ac85ae9ec9 [3mtool_id[0m[2m=[0mmcp_mcp_server-d15db7c5-3bc5-4814-8ed2-e3d6216ffb10_create_person
[2m2026-01-25T16:38:08.280589Z[0m [33m WARN[0m [1mcreate_agent[0m[1m{[0m[3magent_name[0m[2m=[0mtest_complex_schema_eb76b64f[1m}[0m[2m:[0m [2mkelpie_server::api::agents[0m[2m:[0m Referenced MCP tool not found in registry (server may need to be created first) [3magent_id[0m[2m=[0m5f5b1677-27ab-4e67-bb65-46ac85ae9ec9 [3mtool_id[0m[2m=[0mmcp_mcp_server-d15db7c5-3bc5-4814-8ed2-e3d6216ffb10_manage_tasks
[2m2026-01-25T16:38:08.280590Z[0m [32m INFO[0m [1mcreate_agent[0m[1m{[0m[3magent_name[0m[2m=[0mtest_complex_schema_eb76b64f[1m}[0m[2m:[0m [2mkelpie_server::api::agents[0m[2m:[0m created agent [3magent_id[0m[2m=[0m5f5b1677-27ab-4e67-bb65-46ac85ae9ec9 [3mname[0m[2m=[0mtest_complex_schema_eb76b64f [3mblock_count[0m[2m=[0m2
[2m2026-01-25T16:38:08.281387Z[0m [32m INFO[0m [1msend_message[0m[1m{[0m[3magent_id[0m[2m=[0m5f5b1677-27ab-4e67-bb65-46ac85ae9ec9[1m}[0m[2m:[0m [2mkelpie_server::api::messages[0m[2m:[0m Processing message request [3mstream_steps[0m[2m=[0mfalse [3mstream_tokens[0m[2m=[0mfalse
[2m2026-01-25T16:38:10.429967Z[0m [33m WARN[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Tool discovery timed out - MCP server may be slow to start or unresponsive [3mserver_id[0m[2m=[0mmcp_server-0c26a6bc-85a2-4bfc-aa1a-a376ed0c9140 [3mserver_name[0m[2m=[0mupdate-test-stdio-861044ee [3mtimeout_ms[0m[2m=[0m30000
[2m2026-01-25T16:38:10.582746Z[0m [33m WARN[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Tool discovery timed out - MCP server may be slow to start or unresponsive [3mserver_id[0m[2m=[0mmcp_server-e05f6a7b-d4bb-47da-be84-461c2b0da6ad [3mserver_name[0m[2m=[0mpartial-update-3fd93bf0 [3mtimeout_ms[0m[2m=[0m30000
[2m2026-01-25T16:38:11.971291Z[0m [32m INFO[0m [1msend_message[0m[1m{[0m[3magent_id[0m[2m=[0m5f5b1677-27ab-4e67-bb65-46ac85ae9ec9[1m}[0m[2m:[0m[1msend_message_json[0m[1m{[0m[3magent_id[0m[2m=[0m5f5b1677-27ab-4e67-bb65-46ac85ae9ec9[1m}[0m[2m:[0m [2mkelpie_server::api::messages[0m[2m:[0m Processed message via AgentService [3magent_id[0m[2m=[0m5f5b1677-27ab-4e67-bb65-46ac85ae9ec9 [3mmessage_count[0m[2m=[0m2
[2m2026-01-25T16:38:11.975212Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-d15db7c5-3bc5-4814-8ed2-e3d6216ffb10[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Disconnected from MCP server [3mserver[0m[2m=[0mtest-complex-schema-8d98a68f
[2m2026-01-25T16:38:11.975267Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-d15db7c5-3bc5-4814-8ed2-e3d6216ffb10[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Disconnected MCP client and unregistered tools [3mserver_id[0m[2m=[0mmcp_server-d15db7c5-3bc5-4814-8ed2-e3d6216ffb10 [3mserver_name[0m[2m=[0mtest-complex-schema-8d98a68f
[2m2026-01-25T16:38:11.984135Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-d15db7c5-3bc5-4814-8ed2-e3d6216ffb10[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Deleted MCP server [3mserver_id[0m[2m=[0mmcp_server-d15db7c5-3bc5-4814-8ed2-e3d6216ffb10
FAILED [ 91%]
tests/sdk/mcp_servers_test.py::test_comprehensive_mcp_server_tool_listing [2m2026-01-25T16:38:12.013980Z[0m [32m INFO[0m [1mcreate_server[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Created MCP server [3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mserver_name[0m[2m=[0mtest-comprehensive-adf8b78b
[2m2026-01-25T16:38:12.014012Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mtest-comprehensive-adf8b78b
[2m2026-01-25T16:38:12.014015Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0m/Users/seshendranalla/Development/kelpie/letta-repo/.venv/bin/python3.13 [3margs[0m[2m=[0m["/Users/seshendranalla/Development/kelpie/letta-repo/tests/sdk/mock_mcp_server.py"]
[2m2026-01-25T16:38:12.016003Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mtest-comprehensive-adf8b78b
[2m2026-01-25T16:38:12.016007Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0m/Users/seshendranalla/Development/kelpie/letta-repo/.venv/bin/python3.13 [3margs[0m[2m=[0m["/Users/seshendranalla/Development/kelpie/letta-repo/tests/sdk/mock_mcp_server.py"]
[2m2026-01-25T16:38:12.277432Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m MCP server initialized [3mserver_name[0m[2m=[0mmock-mcp-server [3mserver_version[0m[2m=[0m1.26.0 [3mprotocol_version[0m[2m=[0m2024-11-05
[2m2026-01-25T16:38:12.277443Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Connected to MCP server [3mserver[0m[2m=[0mtest-comprehensive-adf8b78b
[2m2026-01-25T16:38:12.277786Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m MCP server initialized [3mserver_name[0m[2m=[0mmock-mcp-server [3mserver_version[0m[2m=[0m1.26.0 [3mprotocol_version[0m[2m=[0m2024-11-05
[2m2026-01-25T16:38:12.277794Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Connected to MCP server [3mserver[0m[2m=[0mtest-comprehensive-adf8b78b
[2m2026-01-25T16:38:12.278564Z[0m [32m INFO[0m [2mkelpie_tools::mcp[0m[2m:[0m Discovered tools [3mserver[0m[2m=[0mtest-comprehensive-adf8b78b [3mtool_count[0m[2m=[0m9 [3mpages[0m[2m=[0m1
[2m2026-01-25T16:38:12.278572Z[0m [32m INFO[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Connected to MCP server and registered tools [3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mserver_name[0m[2m=[0mtest-comprehensive-adf8b78b [3mtool_count[0m[2m=[0m9
[2m2026-01-25T16:38:12.278879Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Discovered tools [3mserver[0m[2m=[0mtest-comprehensive-adf8b78b [3mtool_count[0m[2m=[0m9 [3mpages[0m[2m=[0m1
[2m2026-01-25T16:38:12.280463Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Disconnected from MCP server [3mserver[0m[2m=[0mtest-comprehensive-adf8b78b
[2m2026-01-25T16:38:12.280533Z[0m [32m INFO[0m [1mlist_server_tools[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Discovered MCP server tools [3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_count[0m[2m=[0m9
[2m2026-01-25T16:38:12.281563Z[0m [32m INFO[0m [1mget_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_echo[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mtest-comprehensive-adf8b78b
[2m2026-01-25T16:38:12.281566Z[0m [32m INFO[0m [1mget_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_echo[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0m/Users/seshendranalla/Development/kelpie/letta-repo/.venv/bin/python3.13 [3margs[0m[2m=[0m["/Users/seshendranalla/Development/kelpie/letta-repo/tests/sdk/mock_mcp_server.py"]
[2m2026-01-25T16:38:12.518438Z[0m [32m INFO[0m [1mget_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_echo[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m MCP server initialized [3mserver_name[0m[2m=[0mmock-mcp-server [3mserver_version[0m[2m=[0m1.26.0 [3mprotocol_version[0m[2m=[0m2024-11-05
[2m2026-01-25T16:38:12.518450Z[0m [32m INFO[0m [1mget_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_echo[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Connected to MCP server [3mserver[0m[2m=[0mtest-comprehensive-adf8b78b
[2m2026-01-25T16:38:12.519470Z[0m [32m INFO[0m [1mget_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_echo[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Discovered tools [3mserver[0m[2m=[0mtest-comprehensive-adf8b78b [3mtool_count[0m[2m=[0m9 [3mpages[0m[2m=[0m1
[2m2026-01-25T16:38:12.520660Z[0m [32m INFO[0m [1mget_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_echo[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Disconnected from MCP server [3mserver[0m[2m=[0mtest-comprehensive-adf8b78b
[2m2026-01-25T16:38:12.520735Z[0m [32m INFO[0m [1mget_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_echo[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Retrieved MCP server tool [3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_echo
[2m2026-01-25T16:38:12.521512Z[0m [32m INFO[0m [1mget_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_add[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mtest-comprehensive-adf8b78b
[2m2026-01-25T16:38:12.521515Z[0m [32m INFO[0m [1mget_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_add[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0m/Users/seshendranalla/Development/kelpie/letta-repo/.venv/bin/python3.13 [3margs[0m[2m=[0m["/Users/seshendranalla/Development/kelpie/letta-repo/tests/sdk/mock_mcp_server.py"]
[2m2026-01-25T16:38:12.763452Z[0m [32m INFO[0m [1mget_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_add[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m MCP server initialized [3mserver_name[0m[2m=[0mmock-mcp-server [3mserver_version[0m[2m=[0m1.26.0 [3mprotocol_version[0m[2m=[0m2024-11-05
[2m2026-01-25T16:38:12.763466Z[0m [32m INFO[0m [1mget_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_add[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Connected to MCP server [3mserver[0m[2m=[0mtest-comprehensive-adf8b78b
[2m2026-01-25T16:38:12.764521Z[0m [32m INFO[0m [1mget_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_add[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Discovered tools [3mserver[0m[2m=[0mtest-comprehensive-adf8b78b [3mtool_count[0m[2m=[0m9 [3mpages[0m[2m=[0m1
[2m2026-01-25T16:38:12.765824Z[0m [32m INFO[0m [1mget_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_add[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Disconnected from MCP server [3mserver[0m[2m=[0mtest-comprehensive-adf8b78b
[2m2026-01-25T16:38:12.765898Z[0m [32m INFO[0m [1mget_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_add[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Retrieved MCP server tool [3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_add
[2m2026-01-25T16:38:12.766696Z[0m [32m INFO[0m [1mget_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_multiply[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mtest-comprehensive-adf8b78b
[2m2026-01-25T16:38:12.766701Z[0m [32m INFO[0m [1mget_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_multiply[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0m/Users/seshendranalla/Development/kelpie/letta-repo/.venv/bin/python3.13 [3margs[0m[2m=[0m["/Users/seshendranalla/Development/kelpie/letta-repo/tests/sdk/mock_mcp_server.py"]
[2m2026-01-25T16:38:13.047585Z[0m [32m INFO[0m [1mget_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_multiply[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m MCP server initialized [3mserver_name[0m[2m=[0mmock-mcp-server [3mserver_version[0m[2m=[0m1.26.0 [3mprotocol_version[0m[2m=[0m2024-11-05
[2m2026-01-25T16:38:13.047596Z[0m [32m INFO[0m [1mget_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_multiply[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Connected to MCP server [3mserver[0m[2m=[0mtest-comprehensive-adf8b78b
[2m2026-01-25T16:38:13.048530Z[0m [32m INFO[0m [1mget_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_multiply[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Discovered tools [3mserver[0m[2m=[0mtest-comprehensive-adf8b78b [3mtool_count[0m[2m=[0m9 [3mpages[0m[2m=[0m1
[2m2026-01-25T16:38:13.049841Z[0m [32m INFO[0m [1mget_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_multiply[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Disconnected from MCP server [3mserver[0m[2m=[0mtest-comprehensive-adf8b78b
[2m2026-01-25T16:38:13.049915Z[0m [32m INFO[0m [1mget_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_multiply[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Retrieved MCP server tool [3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_multiply
[2m2026-01-25T16:38:13.050801Z[0m [32m INFO[0m [1mrun_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_echo[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Connecting to MCP server [3mserver[0m[2m=[0mtest-comprehensive-adf8b78b
[2m2026-01-25T16:38:13.050805Z[0m [32m INFO[0m [1mrun_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_echo[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Spawning stdio MCP server [3mcommand[0m[2m=[0m/Users/seshendranalla/Development/kelpie/letta-repo/.venv/bin/python3.13 [3margs[0m[2m=[0m["/Users/seshendranalla/Development/kelpie/letta-repo/tests/sdk/mock_mcp_server.py"]
[2m2026-01-25T16:38:13.286271Z[0m [32m INFO[0m [1mrun_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_echo[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m MCP server initialized [3mserver_name[0m[2m=[0mmock-mcp-server [3mserver_version[0m[2m=[0m1.26.0 [3mprotocol_version[0m[2m=[0m2024-11-05
[2m2026-01-25T16:38:13.286282Z[0m [32m INFO[0m [1mrun_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_echo[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Connected to MCP server [3mserver[0m[2m=[0mtest-comprehensive-adf8b78b
[2m2026-01-25T16:38:13.288223Z[0m [32m INFO[0m [1mrun_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_echo[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Disconnected from MCP server [3mserver[0m[2m=[0mtest-comprehensive-adf8b78b
[2m2026-01-25T16:38:13.288230Z[0m [32m INFO[0m [1mrun_server_tool[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_echo[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Executed MCP server tool [3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mtool_id[0m[2m=[0mmcp_mcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0_echo
[2m2026-01-25T16:38:13.290242Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0[1m}[0m[2m:[0m [2mkelpie_tools::mcp[0m[2m:[0m Disconnected from MCP server [3mserver[0m[2m=[0mtest-comprehensive-adf8b78b
[2m2026-01-25T16:38:13.290277Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Disconnected MCP client and unregistered tools [3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0 [3mserver_name[0m[2m=[0mtest-comprehensive-adf8b78b
[2m2026-01-25T16:38:13.298803Z[0m [32m INFO[0m [1mdelete_server[0m[1m{[0m[3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0[1m}[0m[2m:[0m [2mkelpie_server::api::mcp_servers[0m[2m:[0m Deleted MCP server [3mserver_id[0m[2m=[0mmcp_server-6a7bd6b4-95c5-41d4-847e-d1446bce12b0
PASSED [ 93%]
tests/sdk/agents_test.py::test_delete [2m2026-01-25T16:38:13.305518Z[0m [32m INFO[0m [1mdelete_agent[0m[1m{[0m[3magent_id[0m[2m=[0m76c8659f-d27c-46a0-98e2-d7fd65288f62[1m}[0m[2m:[0m [2mkelpie_server::api::agents[0m[2m:[0m deleted agent [3magent_id[0m[2m=[0m76c8659f-d27c-46a0-98e2-d7fd65288f62
[2m2026-01-25T16:38:13.305540Z[0m [32m INFO[0m [1mrun[0m[2m:[0m[1mdeactivate[0m[1m{[0m[3mactor_id[0m[2m=[0magents:76c8659f-d27c-46a0-98e2-d7fd65288f62[1m}[0m[2m:[0m [2mkelpie_runtime::activation[0m[2m:[0m Actor deactivated [3mactor_id[0m[2m=[0magents:76c8659f-d27c-46a0-98e2-d7fd65288f62 [3minvocations[0m[2m=[0m5 [3merrors[0m[2m=[0m0
[2m2026-01-25T16:38:13.306080Z[0m [32m INFO[0m [1mrun[0m[2m:[0m[1mactivate[0m[1m{[0m[3mid[0m[2m=[0mActorId { namespace: "agents", id: "76c8659f-d27c-46a0-98e2-d7fd65288f62" } [3mactor_id[0m[2m=[0magents:76c8659f-d27c-46a0-98e2-d7fd65288f62[1m}[0m[2m:[0m[1mactivate_with_time[0m[1m{[0m[3mid[0m[2m=[0mActorId { namespace: "agents", id: "76c8659f-d27c-46a0-98e2-d7fd65288f62" } [3mactor_id[0m[2m=[0magents:76c8659f-d27c-46a0-98e2-d7fd65288f62[1m}[0m[2m:[0m [2mkelpie_runtime::activation[0m[2m:[0m Actor activated [3mactor_id[0m[2m=[0magents:76c8659f-d27c-46a0-98e2-d7fd65288f62
PASSED                             [ 95%]
tests/sdk/blocks_test.py::test_delete [2m2026-01-25T16:38:13.307434Z[0m [32m INFO[0m [1mdelete_block[0m[1m{[0m[3mblock_id[0m[2m=[0m9fb0086c-09f4-40e6-a956-bdef086d5f77[1m}[0m[2m:[0m [2mkelpie_server::api::standalone_blocks[0m[2m:[0m deleted standalone block [3mblock_id[0m[2m=[0m9fb0086c-09f4-40e6-a956-bdef086d5f77
[2m2026-01-25T16:38:13.307964Z[0m [32m INFO[0m [1mdelete_block[0m[1m{[0m[3mblock_id[0m[2m=[0mc440d7b9-9594-4a60-88cd-4130223099d2[1m}[0m[2m:[0m [2mkelpie_server::api::standalone_blocks[0m[2m:[0m deleted standalone block [3mblock_id[0m[2m=[0mc440d7b9-9594-4a60-88cd-4130223099d2
PASSED                             [ 97%]
tests/sdk/tools_test.py::test_delete [2m2026-01-25T16:38:13.318129Z[0m [32m INFO[0m [1mdelete_tool[0m[1m{[0m[3mname_or_id[0m[2m=[0m6251d977-39aa-5afc-938f-219b2a81df16[1m}[0m[2m:[0m [2mkelpie_server::api::tools[0m[2m:[0m Deleted tool [3mname[0m[2m=[0mfriendly_func
[2m2026-01-25T16:38:13.326567Z[0m [32m INFO[0m [1mdelete_tool[0m[1m{[0m[3mname_or_id[0m[2m=[0mda95937d-701e-5a34-ad8f-6288a17e3c5c[1m}[0m[2m:[0m [2mkelpie_server::api::tools[0m[2m:[0m Deleted tool [3mname[0m[2m=[0munfriendly_func
PASSED                              [100%][2m2026-01-25T16:38:13.328297Z[0m [32m INFO[0m [1mdelete_agent[0m[1m{[0m[3magent_id[0m[2m=[0mbaf34ad0-ec6f-4b22-b13c-ac4713d0d705[1m}[0m[2m:[0m [2mkelpie_server::api::agents[0m[2m:[0m deleted agent [3magent_id[0m[2m=[0mbaf34ad0-ec6f-4b22-b13c-ac4713d0d705
[2m2026-01-25T16:38:13.328316Z[0m [32m INFO[0m [1mrun[0m[2m:[0m[1mdeactivate[0m[1m{[0m[3mactor_id[0m[2m=[0magents:baf34ad0-ec6f-4b22-b13c-ac4713d0d705[1m}[0m[2m:[0m [2mkelpie_runtime::activation[0m[2m:[0m Actor deactivated [3mactor_id[0m[2m=[0magents:baf34ad0-ec6f-4b22-b13c-ac4713d0d705 [3minvocations[0m[2m=[0m2 [3merrors[0m[2m=[0m0
[2m2026-01-25T16:38:13.328804Z[0m [32m INFO[0m [1mdelete_agent[0m[1m{[0m[3magent_id[0m[2m=[0m319cd5e1-a22e-47c7-843c-69cd174718bc[1m}[0m[2m:[0m [2mkelpie_server::api::agents[0m[2m:[0m deleted agent [3magent_id[0m[2m=[0m319cd5e1-a22e-47c7-843c-69cd174718bc
[2m2026-01-25T16:38:13.328820Z[0m [32m INFO[0m [1mrun[0m[2m:[0m[1mdeactivate[0m[1m{[0m[3mactor_id[0m[2m=[0magents:319cd5e1-a22e-47c7-843c-69cd174718bc[1m}[0m[2m:[0m [2mkelpie_runtime::activation[0m[2m:[0m Actor deactivated [3mactor_id[0m[2m=[0magents:319cd5e1-a22e-47c7-843c-69cd174718bc [3minvocations[0m[2m=[0m2 [3merrors[0m[2m=[0m0
[2m2026-01-25T16:38:13.329301Z[0m [32m INFO[0m [1mdelete_agent[0m[1m{[0m[3magent_id[0m[2m=[0m020bc71c-6492-425c-8707-1a71ac9f99f8[1m}[0m[2m:[0m [2mkelpie_server::api::agents[0m[2m:[0m deleted agent [3magent_id[0m[2m=[0m020bc71c-6492-425c-8707-1a71ac9f99f8
[2m2026-01-25T16:38:13.329326Z[0m [32m INFO[0m [1mrun[0m[2m:[0m[1mdeactivate[0m[1m{[0m[3mactor_id[0m[2m=[0magents:020bc71c-6492-425c-8707-1a71ac9f99f8[1m}[0m[2m:[0m [2mkelpie_runtime::activation[0m[2m:[0m Actor deactivated [3mactor_id[0m[2m=[0magents:020bc71c-6492-425c-8707-1a71ac9f99f8 [3minvocations[0m[2m=[0m2 [3merrors[0m[2m=[0m0


=================================== FAILURES ===================================
__________________________ test_list[query_params0-1] __________________________
tests/sdk/conftest.py:219: in test_list
    assert len(test_items_list) == count
E   assert 0 == 1
E    +  where 0 = len([])
----------------------------- Captured stdout call -----------------------------
httpx - INFO - HTTP Request: GET http://localhost:8283/v1/agents/ "HTTP/1.1 200 OK"
httpx - INFO - HTTP Request: GET http://localhost:8283/v1/agents/?after=16220878-55ee-4644-8beb-0379a599a6aa "HTTP/1.1 200 OK"
httpx - INFO - HTTP Request: GET http://localhost:8283/v1/agents/?after=1a8e71f5-cdb4-4eed-a0f9-d132bf1e636e "HTTP/1.1 200 OK"
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1025 HTTP Request: GET http://localhost:8283/v1/agents/ "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1025 HTTP Request: GET http://localhost:8283/v1/agents/?after=16220878-55ee-4644-8beb-0379a599a6aa "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1025 HTTP Request: GET http://localhost:8283/v1/agents/?after=1a8e71f5-cdb4-4eed-a0f9-d132bf1e636e "HTTP/1.1 200 OK"
__________________________ test_list[query_params1-1] __________________________
tests/sdk/conftest.py:219: in test_list
    assert len(test_items_list) == count
E   assert 0 == 1
E    +  where 0 = len([])
----------------------------- Captured stdout call -----------------------------
httpx - INFO - HTTP Request: GET http://localhost:8283/v1/agents/?name=caren_updated "HTTP/1.1 200 OK"
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1025 HTTP Request: GET http://localhost:8283/v1/agents/?name=caren_updated "HTTP/1.1 200 OK"
________________________ test_mcp_echo_tool_with_agent _________________________
tests/sdk/mcp_servers_test.py:794: in test_mcp_echo_tool_with_agent
    echo_call = next((m for m in tool_calls if m.tool_call.name == "echo"), None)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/sdk/mcp_servers_test.py:794: in <genexpr>
    echo_call = next((m for m in tool_calls if m.tool_call.name == "echo"), None)
                                               ^^^^^^^^^^^^^^^^
E   AttributeError: 'dict' object has no attribute 'name'
---------------------------- Captured stdout setup -----------------------------
httpx - INFO - HTTP Request: POST http://localhost:8283/v1/mcp-servers/ "HTTP/1.1 200 OK"
httpx - INFO - HTTP Request: GET http://localhost:8283/v1/mcp-servers/mcp_server-4b996a35-edc1-4df9-8e30-bfc43c1282e6/tools "HTTP/1.1 200 OK"
httpx - INFO - HTTP Request: POST http://localhost:8283/v1/agents/ "HTTP/1.1 200 OK"
------------------------------ Captured log setup ------------------------------
INFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:8283/v1/mcp-servers/ "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1025 HTTP Request: GET http://localhost:8283/v1/mcp-servers/mcp_server-4b996a35-edc1-4df9-8e30-bfc43c1282e6/tools "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:8283/v1/agents/ "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
httpx - INFO - HTTP Request: POST http://localhost:8283/v1/agents/78260e5a-ed43-44cf-9b54-1528d63514fb/messages "HTTP/1.1 200 OK"
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:8283/v1/agents/78260e5a-ed43-44cf-9b54-1528d63514fb/messages "HTTP/1.1 200 OK"
--------------------------- Captured stdout teardown ---------------------------
httpx - INFO - HTTP Request: DELETE http://localhost:8283/v1/agents/78260e5a-ed43-44cf-9b54-1528d63514fb "HTTP/1.1 200 OK"
httpx - INFO - HTTP Request: DELETE http://localhost:8283/v1/mcp-servers/mcp_server-4b996a35-edc1-4df9-8e30-bfc43c1282e6 "HTTP/1.1 200 OK"
---------------------------- Captured log teardown -----------------------------
INFO     httpx:_client.py:1025 HTTP Request: DELETE http://localhost:8283/v1/agents/78260e5a-ed43-44cf-9b54-1528d63514fb "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1025 HTTP Request: DELETE http://localhost:8283/v1/mcp-servers/mcp_server-4b996a35-edc1-4df9-8e30-bfc43c1282e6 "HTTP/1.1 200 OK"
_________________________ test_mcp_add_tool_with_agent _________________________
tests/sdk/mcp_servers_test.py:832: in test_mcp_add_tool_with_agent
    add_call = next((m for m in tool_calls if m.tool_call.name == "add"), None)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/sdk/mcp_servers_test.py:832: in <genexpr>
    add_call = next((m for m in tool_calls if m.tool_call.name == "add"), None)
                                              ^^^^^^^^^^^^^^^^
E   AttributeError: 'dict' object has no attribute 'name'
---------------------------- Captured stdout setup -----------------------------
httpx - INFO - HTTP Request: POST http://localhost:8283/v1/mcp-servers/ "HTTP/1.1 200 OK"
httpx - INFO - HTTP Request: GET http://localhost:8283/v1/mcp-servers/mcp_server-bb90f8e4-b6a4-47e2-8858-e0e6c66b95fe/tools "HTTP/1.1 200 OK"
httpx - INFO - HTTP Request: POST http://localhost:8283/v1/agents/ "HTTP/1.1 200 OK"
------------------------------ Captured log setup ------------------------------
INFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:8283/v1/mcp-servers/ "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1025 HTTP Request: GET http://localhost:8283/v1/mcp-servers/mcp_server-bb90f8e4-b6a4-47e2-8858-e0e6c66b95fe/tools "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:8283/v1/agents/ "HTTP/1.1 200 OK"
----------------------------- Captured stdout call -----------------------------
httpx - INFO - HTTP Request: POST http://localhost:8283/v1/agents/0eecc832-e03d-4910-8d31-aea9fd9a3aec/messages "HTTP/1.1 200 OK"
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:8283/v1/agents/0eecc832-e03d-4910-8d31-aea9fd9a3aec/messages "HTTP/1.1 200 OK"
--------------------------- Captured stdout teardown ---------------------------
httpx - INFO - HTTP Request: DELETE http://localhost:8283/v1/agents/0eecc832-e03d-4910-8d31-aea9fd9a3aec "HTTP/1.1 200 OK"
httpx - INFO - HTTP Request: DELETE http://localhost:8283/v1/mcp-servers/mcp_server-bb90f8e4-b6a4-47e2-8858-e0e6c66b95fe "HTTP/1.1 200 OK"
---------------------------- Captured log teardown -----------------------------
INFO     httpx:_client.py:1025 HTTP Request: DELETE http://localhost:8283/v1/agents/0eecc832-e03d-4910-8d31-aea9fd9a3aec "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1025 HTTP Request: DELETE http://localhost:8283/v1/mcp-servers/mcp_server-bb90f8e4-b6a4-47e2-8858-e0e6c66b95fe "HTTP/1.1 200 OK"
________________ test_mcp_multiple_tools_in_sequence_with_agent ________________
tests/sdk/mcp_servers_test.py:920: in test_mcp_multiple_tools_in_sequence_with_agent
    assert len(tool_calls) >= 3, f"Expected at least 3 tool calls, got {len(tool_calls)}"
E   AssertionError: Expected at least 3 tool calls, got 1
E   assert 1 >= 3
E    +  where 1 = len([SystemMessage(id='92caca87-d514-4074-90f3-3a63b9978443', content='I don\'t have access to "add", "multiply", or "echo" tools in my available function set. The tools I have available are:\n\n1. `pause_heartbeats` - for pausing heartbeat messages\n2. `conversation_search` - for searching past conversations\n3. `core_memory_append` and `core_memory_replace` - for managing core memory\n4. `archival_memory_insert` and `archival_memory_search` - for archival memory operations\n5. `shell` - for executing shell commands\n\nHowever, I can help you perform these calculations using the shell tool with basic math commands. Let me do that:', date=datetime.datetime(2026, 1, 25, 16, 38, 3, 685707, tzinfo=datetime.timezone.utc), is_err=None, message_type='tool_call_message', name=None, otid=None, run_id=None, sender_id=None, seq_id=None, step_id=None, agent_id='18f5aa72-a062-4aef-8566-8ad496add394', role='assistant', tool_call_id=None, tool_calls=[{'id': 'toolu_01YAVU59S8tiXWahSd4EXFaL', 'name': 'shell', 'arguments': {'command': 'echo $((10 + 20))'}}], tool_call={'name': 'shell', 'arguments': '{"command":"echo $((10 + 20))"}', 'tool_call_id': 'toolu_01YAVU59S8tiXWahSd4EXFaL'})])
----------------------------- Captured stdout call -----------------------------
httpx - INFO - HTTP Request: POST http://localhost:8283/v1/mcp-servers/ "HTTP/1.1 200 OK"
httpx - INFO - HTTP Request: GET http://localhost:8283/v1/mcp-servers/mcp_server-486a02bc-b186-4762-9ade-33fb043194f0/tools "HTTP/1.1 200 OK"
httpx - INFO - HTTP Request: POST http://localhost:8283/v1/agents/ "HTTP/1.1 200 OK"
httpx - INFO - HTTP Request: POST http://localhost:8283/v1/agents/18f5aa72-a062-4aef-8566-8ad496add394/messages "HTTP/1.1 200 OK"
httpx - INFO - HTTP Request: DELETE http://localhost:8283/v1/mcp-servers/mcp_server-486a02bc-b186-4762-9ade-33fb043194f0 "HTTP/1.1 200 OK"
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:8283/v1/mcp-servers/ "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1025 HTTP Request: GET http://localhost:8283/v1/mcp-servers/mcp_server-486a02bc-b186-4762-9ade-33fb043194f0/tools "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:8283/v1/agents/ "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:8283/v1/agents/18f5aa72-a062-4aef-8566-8ad496add394/messages "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1025 HTTP Request: DELETE http://localhost:8283/v1/mcp-servers/mcp_server-486a02bc-b186-4762-9ade-33fb043194f0 "HTTP/1.1 200 OK"
___________________ test_mcp_complex_schema_tool_with_agent ____________________
tests/sdk/mcp_servers_test.py:1023: in test_mcp_complex_schema_tool_with_agent
    assert len(tool_calls) > 0, "Expected at least one tool call message"
E   AssertionError: Expected at least one tool call message
E   assert 0 > 0
E    +  where 0 = len([])
----------------------------- Captured stdout call -----------------------------
httpx - INFO - HTTP Request: POST http://localhost:8283/v1/mcp-servers/ "HTTP/1.1 200 OK"
httpx - INFO - HTTP Request: GET http://localhost:8283/v1/mcp-servers/mcp_server-d15db7c5-3bc5-4814-8ed2-e3d6216ffb10/tools "HTTP/1.1 200 OK"
httpx - INFO - HTTP Request: POST http://localhost:8283/v1/agents/ "HTTP/1.1 200 OK"
httpx - INFO - HTTP Request: POST http://localhost:8283/v1/agents/5f5b1677-27ab-4e67-bb65-46ac85ae9ec9/messages "HTTP/1.1 200 OK"
httpx - INFO - HTTP Request: DELETE http://localhost:8283/v1/mcp-servers/mcp_server-d15db7c5-3bc5-4814-8ed2-e3d6216ffb10 "HTTP/1.1 200 OK"
------------------------------ Captured log call -------------------------------
INFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:8283/v1/mcp-servers/ "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1025 HTTP Request: GET http://localhost:8283/v1/mcp-servers/mcp_server-d15db7c5-3bc5-4814-8ed2-e3d6216ffb10/tools "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:8283/v1/agents/ "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1025 HTTP Request: POST http://localhost:8283/v1/agents/5f5b1677-27ab-4e67-bb65-46ac85ae9ec9/messages "HTTP/1.1 200 OK"
INFO     httpx:_client.py:1025 HTTP Request: DELETE http://localhost:8283/v1/mcp-servers/mcp_server-d15db7c5-3bc5-4814-8ed2-e3d6216ffb10 "HTTP/1.1 200 OK"
=============================== warnings summary ===============================
letta/schemas/letta_message.py:207
  /Users/seshendranalla/Development/kelpie/letta-repo/letta/schemas/letta_message.py:207: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class ToolCallMessage(LettaMessage):

.venv/lib/python3.13/site-packages/pydantic/_internal/_generate_schema.py:319
.venv/lib/python3.13/site-packages/pydantic/_internal/_generate_schema.py:319
.venv/lib/python3.13/site-packages/pydantic/_internal/_generate_schema.py:319
.venv/lib/python3.13/site-packages/pydantic/_internal/_generate_schema.py:319
  /Users/seshendranalla/Development/kelpie/letta-repo/.venv/lib/python3.13/site-packages/pydantic/_internal/_generate_schema.py:319: PydanticDeprecatedSince20: `json_encoders` is deprecated. See https://docs.pydantic.dev/2.12/concepts/serialization/#custom-serializers for alternatives. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    warnings.warn(

letta/schemas/response_format.py:18
  /Users/seshendranalla/Development/kelpie/letta-repo/letta/schemas/response_format.py:18: PydanticDeprecatedSince20: Using extra keyword arguments on `Field` is deprecated and will be removed. Use `json_schema_extra` instead. (Extra keys: 'example'). Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    type: ResponseFormatType = Field(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/sdk/agents_test.py::test_list[query_params0-1] - assert 0 == 1
FAILED tests/sdk/agents_test.py::test_list[query_params1-1] - assert 0 == 1
FAILED tests/sdk/mcp_servers_test.py::test_mcp_echo_tool_with_agent - Attribu...
FAILED tests/sdk/mcp_servers_test.py::test_mcp_add_tool_with_agent - Attribut...
FAILED tests/sdk/mcp_servers_test.py::test_mcp_multiple_tools_in_sequence_with_agent
FAILED tests/sdk/mcp_servers_test.py::test_mcp_complex_schema_tool_with_agent
============= 6 failed, 37 passed, 2 skipped, 6 warnings in 33.61s =============

[0;31m=== âœ— SOME TESTS FAILED ===[0m
[1;33mCheck letta-fdb-test-results.txt for details[0m
[1;33mCleaning up...[0m
  Killed server (PID: 5415)
